"use strict";(()=>{var t={};t.id=516,t.ids=[516],t.modules={20145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},99648:t=>{t.exports=import("axios")},20295:t=>{t.exports=import("cheerio")},98960:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{config:()=>u,default:()=>c,routeModule:()=>h});var s=r(71802),n=r(47153),l=r(56249),o=r(83455),i=t([o]);o=(i.then?(await i)():i)[0];let c=(0,l.l)(o,"default"),u=(0,l.l)(o,"config"),h=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/analyze",pathname:"/api/analyze",bundlePath:"",filename:""},userland:o});a()}catch(t){a(t)}})},83455:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{default:()=>handler});var s=r(99648),n=r(20295),l=r(90067),o=t([s,n,l]);function absoluteUrl(t,e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;if(e.startsWith("//"))return"https:"+e;if(e.startsWith("/"))return new URL(t).origin+e;try{return new URL(e,t).toString()}catch{return e}}function normalizeColor(t){if(!t)return null;let e=t.trim().replace(/!important/i,"").trim();if(/^var\(/i.test(e)||/^transparent$/i.test(e)||/^currentColor$/i.test(e))return null;let r=e.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)?.[0];if(r)return r.toUpperCase();let a=function(t){let e=t.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})/i);if(!e)return null;let r=Math.max(0,Math.min(255,parseInt(e[1],10))),a=Math.max(0,Math.min(255,parseInt(e[2],10))),s=Math.max(0,Math.min(255,parseInt(e[3],10))),toHex=t=>t.toString(16).padStart(2,"0").toUpperCase();return`#${toHex(r)}${toHex(a)}${toHex(s)}`}(e);return a||null}function collectImages(t,e,r){let a=[],s="hero"===r?/(main|slideshow|hero|header)/i:/(banner)/i;return t("img").each((r,n)=>{let l=t(n),o=(l.attr("class")||"")+" "+(l.parent().attr("class")||""),i=(l.attr("id")||"")+" "+(l.parent().attr("id")||"");if(!s.test(o+" "+i))return;let c=l.attr("src")||l.attr("data-src")||"";if(!(c=absoluteUrl(e,c)))return;let u=parseInt(l.attr("width")||"0",10),h=!isNaN(u)&&u>=599,m=/[_-](6\d\d|[7-9]\d\d|\d{4,})x/i.test(c)||/w(=|%3D)(6\d\d|[7-9]\d\d|\d{4,})/i.test(c);(h||m)&&a.push(c)}),Array.from(new Set(a))}function collectMobileBannerImages(t,e){let r=[];return t('img.mobile-banner, img[class*="mobile-banner"]').each((a,s)=>{let n=t(s).attr("src")||t(s).attr("data-src")||"";(n=absoluteUrl(e,n))&&r.push(n)}),t('.mobile-banner img, [class*="mobile-banner"] img').each((a,s)=>{let n=t(s).attr("src")||t(s).attr("data-src")||"";(n=absoluteUrl(e,n))&&r.push(n)}),Array.from(new Set(r))}async function handler(t,e){let{url:r}=t.query;if(!r||"string"!=typeof r){e.status(400).json({error:"Missing url parameter"});return}try{let t=await s.default.get(r,{maxRedirects:5,headers:{"User-Agent":"Mozilla/5.0"}}),a=t.data,o=n.load(a),i=new URL(r).toString(),c=await (0,l.c)(r),u=function(t,e){let r=t('meta[property="og:site_name"]').attr("content");if(r)return r;let a=t("title").first().text().trim();if(a)return a;try{let t=new URL(e).hostname.replace(/^www\./,"");return t.split(".")[0]}catch{return""}}(o,r),h=function(t,e){let r=t('[class*="logo" i]').toArray();for(let a of r){let r=t(a),s=r.find("svg").first();if(s&&s.length){let e=t.html(s);if(e)return{svg:e}}let n=r.find("img").first();if(n&&n.length){let t=n.attr("src")||n.attr("data-src")||"";if(t=absoluteUrl(e,t))return{url:t}}}let a=t('img[alt*="logo" i], img[class*="logo" i]').first(),s=a.attr("src")||a.attr("data-src")||"";return s?{url:absoluteUrl(e,s)}:{}}(o,r),m=collectImages(o,i,"hero"),d=collectMobileBannerImages(o,i);try{let t=new URL(i).origin,e=await s.default.get(t,{headers:{"User-Agent":"Mozilla/5.0"},maxRedirects:5}),r=n.load(e.data),a=collectMobileBannerImages(r,t+"/");d=Array.from(new Set([...d,...a]))}catch(t){}0===d.length&&(d=collectImages(o,i,"banner"));let{candidates:g,primary:f,text:p}=function(t){let e=[];t("style").each((r,a)=>{e.push(t(a).contents().text())});let r=null;for(let t of e){let e=t.match(/--atlas-primary-color\s*:\s*([^;\n\r]+)/i);if(e&&e[1]&&(r=normalizeColor(e[1])))break}let a=function(t,e){let r=[],push=(t,e)=>{let a=e&&normalizeColor(e);a&&r.push({source:t,color:a})};for(let r of(t('[class*="announcement" i], [class*="anouncement" i]').each((e,r)=>{let a=(t(r).attr("style")||"").toString(),s=a.match(/background(?:-color)?\s*:\s*([^;]+)/i);s&&push("announcement-bg",s[1]);let n=a.match(/border(?:-color)?\s*:\s*([^;]+)/i);n&&push("announcement-border",n[1])}),t('.utility-bar, [class*="utility-bar" i]').each((e,r)=>{let a=(t(r).attr("style")||"").toString(),s=a.match(/background(?:-color)?\s*:\s*([^;]+)/i);s&&push("utility-bar-bg",s[1])}),t('[class*="cta" i], [class*="button" i], [class*="btn" i], [class*="add-to-cart" i]').each((e,r)=>{let a=(t(r).attr("style")||"").toString(),s=a.match(/background(?:-color)?\s*:\s*([^;]+)/i);s&&push("cta-bg",s[1]);let n=a.match(/border(?:-color)?\s*:\s*([^;]+)/i);n&&push("cta-border",n[1])}),t("button").each((e,r)=>{let a=(t(r).attr("style")||"").toString(),s=a.match(/background(?:-color)?\s*:\s*([^;]+)/i);s&&push("button-bg",s[1]);let n=a.match(/border(?:-color)?\s*:\s*([^;]+)/i);n&&push("button-border",n[1])}),e)){let t;let e=/\.(?:[^\.{\s]*?(announcement|anouncement)[^\s{]*)[^}]*\{[^}]*?(background(?:-color)?):\s*([^;}{]+);/ig;for(;t=e.exec(r);)push("announcement-bg",t[2]);let a=/\.(?:[^\.{\s]*?(cta|button|btn)[^\s{]*)[^}]*\{[^}]*?(background(?:-color)?):\s*([^;}{]+);/ig;for(;t=a.exec(r);)push("cta-bg",t[2]);let s=/\.(?:[^\.{\s]*?(cta|button|btn)[^\s{]*)[^}]*\{[^}]*?(border(?:-color)?):\s*([^;}{]+);/ig;for(;t=s.exec(r);)push("cta-border",t[2]);let n=/\.(?:[^\.\{\s]*?(utility-bar)[^\s{]*)[^}]*\{[^}]*?(background(?:-color)?):\s*([^;}{]+);/ig;for(;t=n.exec(r);)push("utility-bar-bg",t[2]);let l=/button\s*\{[^}]*?(background(?:-color)?):\s*([^;}{]+);/ig;for(;t=l.exec(r);)push("button-bg",t[1]||t[2])}let a=new Set;return r.filter(({color:t})=>!a.has(t)&&(a.add(t),!0))}(t,e),s=t('meta[name="theme-color"]').attr("content"),n=s?normalizeColor(s):null;n&&a.push({source:"theme-color",color:n});let l=r||a[0]?.color||null,o="black",i=l||a[0]?.color||n;if(i){let t=parseInt(i.substring(1,3),16),e=parseInt(i.substring(3,5),16),r=parseInt(i.substring(5,7),16);o=(299*t+587*e+114*r)/1e3>=128?"black":"white"}return{candidates:a,primary:l||void 0,text:o}}(o),b="",y=o('[class*="announcement" i], [class*="anouncement" i]').first();y&&y.length&&(b=(y.text()||"").replace(/\s+/g," ").trim());let x=function(t){let e=new Set;t('link[rel="stylesheet"][href*="fonts.googleapis.com"]').each((r,a)=>{let s=t(a).attr("href")||"",n=new URL(s,"https://example.com"),l=n.searchParams.get("family");l&&l.split("|").forEach(t=>e.add(t.split(":")[0].replace(/\+/g," ")))}),t("style").each((r,a)=>{let s=t(a).contents().text(),n=s.match(/font-family\s*:\s*([^;\}]+)/gi)||[];n.forEach(t=>{let r=t.split(":")[1]?.trim().replace(/["']/g,"").split(",")[0]?.trim();r&&e.add(r)})});let r=new Set(["sans-serif","serif","monospace","cursive","fantasy","emoji","math","fangsong","system-ui","inherit","initial","unset"]),a=Array.from(e).filter(t=>t&&!/^var\(/i.test(t)&&!/^--/.test(t)&&!r.has(t.toLowerCase())).slice(0,5);return a}(o),w={storeName:u,logo:h.url,logoSvg:h.svg,heroImages:m,bannerImages:d,colorScheme:f?[f]:[],primaryColor:f,textColor:p,colorCandidates:g,fontFamilies:x,announcementCopy:b,product:c};e.status(200).json(w)}catch(t){console.error("Analyze error",t.message||t),e.status(500).json({error:"Failed to analyze page"})}}[s,n,l]=o.then?(await o)():o,a()}catch(t){a(t)}})}};var e=require("../../webpack-api-runtime.js");e.C(t);var __webpack_exec__=t=>e(e.s=t),r=e.X(0,[222,67],()=>__webpack_exec__(98960));module.exports=r})();