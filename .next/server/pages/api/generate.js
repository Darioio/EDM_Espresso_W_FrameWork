"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/generate";
exports.ids = ["pages/api/generate"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "cheerio":
/*!**************************!*\
  !*** external "cheerio" ***!
  \**************************/
/***/ ((module) => {

module.exports = import("cheerio");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fgenerate.ts&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fgenerate.ts&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/generate.ts */ \"(api)/./pages/api/generate.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/generate\",\n        pathname: \"/api/generate\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_generate_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmdlbmVyYXRlJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlMkZhcGklMkZnZW5lcmF0ZS50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNvRDtBQUNwRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsbURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLG1EQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2VkbS1idWlsZGVyLz9iZjExIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvZ2VuZXJhdGUudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9nZW5lcmF0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fgenerate.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./data/templates.ts":
/*!***************************!*\
  !*** ./data/templates.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   defaultTemplates: () => (/* binding */ defaultTemplates),\n/* harmony export */   renderTemplate: () => (/* binding */ renderTemplate)\n/* harmony export */ });\n/**\n * Module containing default HTML email templates and helper\n * functions for simple variable substitution. Templates are defined\n * with double curly braces, e.g. `{{title}}`, which will be\n * replaced with values from a ProductData object. Template\n * designers can add or remove placeholders as needed.\n */ /**\n * Default templates included with the application. New templates\n * added via the UI can be appended at runtime (stored in\n * localStorage on the client). When adding a new template be sure to\n * assign a unique id.\n */ const defaultTemplates = [\n    {\n        id: \"product-image-left-copy-right\",\n        name: \"Image left / Copy right\",\n        // Updated HTML for the left-image / copy-right module. This version\n        // matches the design provided in the archive: a light grey\n        // background with a white card, no pretitle, a price block that\n        // supports an original (compare-at) price via the {{priceHtml}}\n        // placeholder, and right-aligned colour swatches. The CTA uses\n        // the accent colour defined in globals.css.\n        html: `<!-- === Start: Product Feature Module (Image Left / Copy Right) === -->\n<table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" align=\"center\" style=\"margin:0;padding:0;\">\n  <tr>\n    <td align=\"center\" style=\"margin:0;padding:0;\">\n      <!-- Wrapper intentionally omitted (handled by section wrapper) -->\n      <!-- Two Columns -->\n      <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"module-pad\" style=\"width:100%;margin:0;padding:25px;\">\n        <tr>\n          <!-- Left: Image -->\n          <td class=\"stack-cols\" width=\"50%\" valign=\"top\" style=\"padding:0px 12px 0px 0px;\">\n            <a href=\"{{cta}}\" target=\"_blank\" style=\"text-decoration:none;\">\n              <img src=\"{{image}}\" alt=\"{{title}}\" style=\"display:block;width:100%;height:auto;border:0;outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;\">\n            </a>\n          </td>\n          <!-- Right: Copy -->\n          <td class=\"stack-cols\" width=\"50%\" valign=\"top\" style=\"padding:0px 0px 0px 12px;\">\n            <!-- Title -->\n            <h2 style=\"margin:0 0 10px 0;font-family:Montserrat,Arial,Helvetica,sans-serif;font-size:26px;line-height:1.2;color:#111111;font-weight:300;\">\n              {{title}}\n            </h2>\n            <!-- Price (supports original price via priceHtml) -->\n            <p style=\"margin:0 0 10px 0;font-family:Montserrat,Arial,Helvetica,sans-serif;font-size:16px;line-height:1;color:#111111;font-weight:600;\">\n              {{priceHtml}}\n            </p>\n            <!-- Description -->\n            <p style=\"margin:0 0 16px 0;font-family:Montserrat,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.6;color:#333333;\">\n              {{description}}\n            </p>\n            <!-- CTA row -->\n            <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin:0;padding:0;\">\n              <tr>\n                <td align=\"left\" valign=\"middle\" style=\"padding:0;\">\n                  <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin:0;padding:0;\" class=\"cta\">\n                    <tr>\n                      <td align=\"center\" bgcolor=\"{{ctaBg}}\" style=\"background:{{ctaBg}};\">\n                        <a href=\"{{cta}}\" target=\"_blank\" style=\"display:inline-block;padding:12px 22px;font-family:Montserrat,Arial,Helvetica,sans-serif;font-size:14px;line-height:14px;color:#ffffff;text-decoration:none;\">\n                          {{ctaLabel}}\n                        </a>\n                      </td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n            </table>\n            <!-- /CTA row -->\n          </td>\n        </tr>\n      </table>\n      <!-- /Two Columns -->\n    </td>\n  </tr>\n</table>\n<!-- === End: Product Feature Module === -->\n<style>\n@media only screen and (max-width: 600px) {\n  .stack-cols { display:block !important; width:100% !important; padding:0 0 16px 0 !important; }\n  .module-pad { padding:12px !important; }\n  .cta { width:100% !important; }\n}\n</style>`\n    },\n    {\n        id: \"grid\",\n        name: \"Grid\",\n        // Grid template: displays only product images in a responsive grid, no titles or descriptions.\n        html: `<!-- === Start: Product Grid Module === -->\n<table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" align=\"center\" style=\"margin:0;padding:0;\">\n  <tr>\n    <td align=\"center\" style=\"margin:0;padding:0;\">\n      <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"max-width:600px;margin:0 auto;background:#FFFFFF;\">\n        <tr>\n          <td style=\"padding:0px;\">\n            <!-- Product Images Grid -->\n            <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:100%;margin:0;padding:0;\">\n              <tr>\n                {{#each images}}\n                <td align=\"center\" valign=\"top\" style=\"padding:0px;\">\n                  <img src=\"{{.}}\" alt=\"Product image\" style=\"display:block;width:100%;height:auto;border:0;outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;\">\n                </td>\n                {{/each}}\n              </tr>\n            </table>\n            <!-- /Product Images Grid -->\n          </td>\n        </tr>\n      </table>\n    </td>\n  </tr>\n</table>\n<!-- === End: Product Grid Module === -->\n<style>\n@media only screen and (max-width: 600px) {\n  .product-grid-img {\n    width: 80px !important;\n    padding: 4px !important;\n  }\n}\n</style>`\n    },\n    {\n        id: \"product-copy-left-image-right\",\n        name: \"Copy left / Image right\",\n        // Swapped layout: copy appears on the left and image on the right. This\n        // variant matches the new design and removes the pretitle. The\n        // placeholder {{priceHtml}} should contain the formatted price with\n        // any original price included.\n        html: `<!-- === Start: Product Feature Module (Copy Left / Image Right) === -->\n<table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" align=\"center\" style=\"margin:0;padding:0;\">\n  <tr>\n    <td align=\"center\" style=\"margin:0;padding:0;\">\n      <!-- Wrapper intentionally omitted (handled by section wrapper) -->\n      <!-- Two Columns (copy first, image second) -->\n      <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"module-pad\" style=\"width:100%;margin:0;padding:25px;\">\n        <tr>\n          <!-- Left: Copy -->\n          <td class=\"stack-cols\" width=\"50%\" valign=\"top\" style=\"padding:0px 12px 0px 0px;\">\n            <!-- Title -->\n            <h2 style=\"margin:0 0 10px 0;font-family:Montserrat,Arial,Helvetica,sans-serif;font-size:26px;line-height:1.2;color:#111111;font-weight:300;\">\n              {{title}}\n            </h2>\n            <!-- Price -->\n            <p style=\"margin:0 0 10px 0;font-family:Montserrat,Arial,Helvetica,sans-serif;font-size:16px;line-height:1;color:#111111;font-weight:600;\">\n              {{priceHtml}}\n            </p>\n            <!-- Description -->\n            <p style=\"margin:0 0 16px 0;font-family:Montserrat,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.6;color:#333333;\">\n              {{description}}\n            </p>\n            <!-- CTA row -->\n            <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin:0;padding:0;\">\n              <tr>\n                <td align=\"left\" valign=\"middle\" style=\"padding:0;\">\n                  <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin:0;padding:0;\" class=\"cta\">\n                    <tr>\n                      <td align=\"center\" bgcolor=\"{{ctaBg}}\" style=\"background:{{ctaBg}};\">\n                        <a href=\"{{cta}}\" target=\"_blank\" style=\"display:inline-block;padding:12px 22px;font-family:Montserrat,Arial,Helvetica,sans-serif;font-size:14px;line-height:14px;color:#ffffff;text-decoration:none;\">\n                          {{ctaLabel}}\n                        </a>\n                      </td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n            </table>\n            <!-- /CTA row -->\n          </td>\n          <!-- Right: Image -->\n          <td class=\"stack-cols\" width=\"50%\" valign=\"top\" style=\"padding:0px 0px 0px 12px;\">\n            <a href=\"{{cta}}\" target=\"_blank\" style=\"text-decoration:none;\">\n              <img src=\"{{image}}\" alt=\"{{title}}\" style=\"display:block;width:100%;height:auto;border:0;outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;\">\n            </a>\n          </td>\n        </tr>\n      </table>\n      <!-- /Two Columns -->\n    </td>\n  </tr>\n</table>\n<!-- === End: Product Feature Module === -->\n<style>\n@media only screen and (max-width: 600px) {\n  .stack-cols { display:block !important; width:100% !important; padding:0 0 16px 0 !important; }\n  .module-pad { padding:12px !important; }\n  .cta { width:100% !important; }\n}\n</style>`\n    }\n];\n/**\n * Render a template into a concrete HTML string. Takes a template\n * definition and a product data object and substitutes each\n * placeholder. Supports arrays via the simple `{{#each colours}}` syntax.\n *\n * This is a minimal implementation deliberately kept simple. If more\n * powerful templating is required (e.g. conditionals, loops) a\n * dedicated template engine like Handlebars can be introduced. For\n * now only substitution and basic array iteration is supported.\n */ function renderTemplate(template, data) {\n    let result = template.html;\n    // Handle array blocks: {{#each colors}}...{{/each}}\n    const eachRegex = /\\{\\{#each\\s+([a-zA-Z0-9_]+)\\}}([\\s\\S]*?)\\{\\{\\/each\\}}/g;\n    result = result.replace(eachRegex, (_match, key, inner)=>{\n        const arr = Array.isArray(data[key]) ? data[key] : [];\n        return arr.map((item)=>{\n            // Replace {{.}} within the inner block with the item itself.\n            return inner.replace(/\\{\\{\\.\\}\\}/g, String(item));\n        }).join(\"\");\n    });\n    // Replace simple variables: {{title}}\n    result = result.replace(/\\{\\{\\s*([a-zA-Z0-9_]+)\\s*\\}\\}/g, (_m, key)=>{\n        const value = data[key];\n        return value !== undefined && value !== null ? String(value) : \"\";\n    });\n    return result;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9kYXRhL3RlbXBsYXRlcy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Q0FNQyxHQVdEOzs7OztDQUtDLEdBQ00sTUFBTUEsbUJBQStCO0lBQzFDO1FBQ0VDLElBQUk7UUFDSkMsTUFBTTtRQUNOLG9FQUFvRTtRQUNwRSwyREFBMkQ7UUFDM0QsZ0VBQWdFO1FBQ2hFLGdFQUFnRTtRQUNoRSwrREFBK0Q7UUFDL0QsNENBQTRDO1FBQzVDQyxNQUFNLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1FBMkRILENBQUM7SUFDUDtJQUNFO1FBQ0FGLElBQUk7UUFDSkMsTUFBTTtRQUNOLCtGQUErRjtRQUMvRkMsTUFBTSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztRQWdDSCxDQUFDO0lBQ1A7SUFDRTtRQUNBRixJQUFJO1FBQ0pDLE1BQU07UUFDTix3RUFBd0U7UUFDeEUsK0RBQStEO1FBQy9ELG9FQUFvRTtRQUNwRSwrQkFBK0I7UUFDL0JDLE1BQU0sQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7UUEyREgsQ0FBQztJQUNQO0NBQ0QsQ0FBQztBQUVGOzs7Ozs7Ozs7Q0FTQyxHQUNNLFNBQVNDLGVBQWVDLFFBQWtCLEVBQUVDLElBQXlCO0lBQzFFLElBQUlDLFNBQVNGLFNBQVNGLElBQUk7SUFDMUIsb0RBQW9EO0lBQ3BELE1BQU1LLFlBQVk7SUFDbEJELFNBQVNBLE9BQU9FLE9BQU8sQ0FBQ0QsV0FBVyxDQUFDRSxRQUFRQyxLQUFhQztRQUN2RCxNQUFNQyxNQUFNQyxNQUFNQyxPQUFPLENBQUNULElBQUksQ0FBQ0ssSUFBSSxJQUFLTCxJQUFJLENBQUNLLElBQUksR0FBYSxFQUFFO1FBQ2hFLE9BQU9FLElBQ0pHLEdBQUcsQ0FBQyxDQUFDQztZQUNKLDZEQUE2RDtZQUM3RCxPQUFPTCxNQUFNSCxPQUFPLENBQUMsZUFBZVMsT0FBT0Q7UUFDN0MsR0FDQ0UsSUFBSSxDQUFDO0lBQ1Y7SUFDQSxzQ0FBc0M7SUFDdENaLFNBQVNBLE9BQU9FLE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQ1csSUFBSVQ7UUFDN0QsTUFBTVUsUUFBUWYsSUFBSSxDQUFDSyxJQUFJO1FBQ3ZCLE9BQU9VLFVBQVVDLGFBQWFELFVBQVUsT0FBT0gsT0FBT0csU0FBUztJQUNqRTtJQUNBLE9BQU9kO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9lZG0tYnVpbGRlci8uL2RhdGEvdGVtcGxhdGVzLnRzP2RjMzQiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNb2R1bGUgY29udGFpbmluZyBkZWZhdWx0IEhUTUwgZW1haWwgdGVtcGxhdGVzIGFuZCBoZWxwZXJcbiAqIGZ1bmN0aW9ucyBmb3Igc2ltcGxlIHZhcmlhYmxlIHN1YnN0aXR1dGlvbi4gVGVtcGxhdGVzIGFyZSBkZWZpbmVkXG4gKiB3aXRoIGRvdWJsZSBjdXJseSBicmFjZXMsIGUuZy4gYHt7dGl0bGV9fWAsIHdoaWNoIHdpbGwgYmVcbiAqIHJlcGxhY2VkIHdpdGggdmFsdWVzIGZyb20gYSBQcm9kdWN0RGF0YSBvYmplY3QuIFRlbXBsYXRlXG4gKiBkZXNpZ25lcnMgY2FuIGFkZCBvciByZW1vdmUgcGxhY2Vob2xkZXJzIGFzIG5lZWRlZC5cbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIFRlbXBsYXRlIHtcbiAgLyoqIFVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgdGVtcGxhdGUgKi9cbiAgaWQ6IHN0cmluZztcbiAgLyoqIEh1bWFu4oCRZnJpZW5kbHkgbmFtZSBzaG93biBpbiB0aGUgVUkgKi9cbiAgbmFtZTogc3RyaW5nO1xuICAvKiogUmF3IEhUTUwgb2YgdGhlIG1vZHVsZS4gVXNlIHBsYWNlaG9sZGVycyBsaWtlIHt7dGl0bGV9fSAqL1xuICBodG1sOiBzdHJpbmc7XG59XG5cbi8qKlxuICogRGVmYXVsdCB0ZW1wbGF0ZXMgaW5jbHVkZWQgd2l0aCB0aGUgYXBwbGljYXRpb24uIE5ldyB0ZW1wbGF0ZXNcbiAqIGFkZGVkIHZpYSB0aGUgVUkgY2FuIGJlIGFwcGVuZGVkIGF0IHJ1bnRpbWUgKHN0b3JlZCBpblxuICogbG9jYWxTdG9yYWdlIG9uIHRoZSBjbGllbnQpLiBXaGVuIGFkZGluZyBhIG5ldyB0ZW1wbGF0ZSBiZSBzdXJlIHRvXG4gKiBhc3NpZ24gYSB1bmlxdWUgaWQuXG4gKi9cbmV4cG9ydCBjb25zdCBkZWZhdWx0VGVtcGxhdGVzOiBUZW1wbGF0ZVtdID0gW1xuICB7XG4gICAgaWQ6ICdwcm9kdWN0LWltYWdlLWxlZnQtY29weS1yaWdodCcsXG4gICAgbmFtZTogJ0ltYWdlIGxlZnQgLyBDb3B5IHJpZ2h0JyxcbiAgICAvLyBVcGRhdGVkIEhUTUwgZm9yIHRoZSBsZWZ0LWltYWdlIC8gY29weS1yaWdodCBtb2R1bGUuIFRoaXMgdmVyc2lvblxuICAgIC8vIG1hdGNoZXMgdGhlIGRlc2lnbiBwcm92aWRlZCBpbiB0aGUgYXJjaGl2ZTogYSBsaWdodCBncmV5XG4gICAgLy8gYmFja2dyb3VuZCB3aXRoIGEgd2hpdGUgY2FyZCwgbm8gcHJldGl0bGUsIGEgcHJpY2UgYmxvY2sgdGhhdFxuICAgIC8vIHN1cHBvcnRzIGFuIG9yaWdpbmFsIChjb21wYXJlLWF0KSBwcmljZSB2aWEgdGhlIHt7cHJpY2VIdG1sfX1cbiAgICAvLyBwbGFjZWhvbGRlciwgYW5kIHJpZ2h0LWFsaWduZWQgY29sb3VyIHN3YXRjaGVzLiBUaGUgQ1RBIHVzZXNcbiAgICAvLyB0aGUgYWNjZW50IGNvbG91ciBkZWZpbmVkIGluIGdsb2JhbHMuY3NzLlxuICAgIGh0bWw6IGA8IS0tID09PSBTdGFydDogUHJvZHVjdCBGZWF0dXJlIE1vZHVsZSAoSW1hZ2UgTGVmdCAvIENvcHkgUmlnaHQpID09PSAtLT5cbjx0YWJsZSByb2xlPVwicHJlc2VudGF0aW9uXCIgd2lkdGg9XCIxMDAlXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCIgYm9yZGVyPVwiMFwiIGFsaWduPVwiY2VudGVyXCIgc3R5bGU9XCJtYXJnaW46MDtwYWRkaW5nOjA7XCI+XG4gIDx0cj5cbiAgICA8dGQgYWxpZ249XCJjZW50ZXJcIiBzdHlsZT1cIm1hcmdpbjowO3BhZGRpbmc6MDtcIj5cbiAgICAgIDwhLS0gV3JhcHBlciBpbnRlbnRpb25hbGx5IG9taXR0ZWQgKGhhbmRsZWQgYnkgc2VjdGlvbiB3cmFwcGVyKSAtLT5cbiAgICAgIDwhLS0gVHdvIENvbHVtbnMgLS0+XG4gICAgICA8dGFibGUgcm9sZT1cInByZXNlbnRhdGlvblwiIHdpZHRoPVwiMTAwJVwiIGNlbGxwYWRkaW5nPVwiMFwiIGNlbGxzcGFjaW5nPVwiMFwiIGJvcmRlcj1cIjBcIiBjbGFzcz1cIm1vZHVsZS1wYWRcIiBzdHlsZT1cIndpZHRoOjEwMCU7bWFyZ2luOjA7cGFkZGluZzoyNXB4O1wiPlxuICAgICAgICA8dHI+XG4gICAgICAgICAgPCEtLSBMZWZ0OiBJbWFnZSAtLT5cbiAgICAgICAgICA8dGQgY2xhc3M9XCJzdGFjay1jb2xzXCIgd2lkdGg9XCI1MCVcIiB2YWxpZ249XCJ0b3BcIiBzdHlsZT1cInBhZGRpbmc6MHB4IDEycHggMHB4IDBweDtcIj5cbiAgICAgICAgICAgIDxhIGhyZWY9XCJ7e2N0YX19XCIgdGFyZ2V0PVwiX2JsYW5rXCIgc3R5bGU9XCJ0ZXh0LWRlY29yYXRpb246bm9uZTtcIj5cbiAgICAgICAgICAgICAgPGltZyBzcmM9XCJ7e2ltYWdlfX1cIiBhbHQ9XCJ7e3RpdGxlfX1cIiBzdHlsZT1cImRpc3BsYXk6YmxvY2s7d2lkdGg6MTAwJTtoZWlnaHQ6YXV0bztib3JkZXI6MDtvdXRsaW5lOjA7dGV4dC1kZWNvcmF0aW9uOm5vbmU7LW1zLWludGVycG9sYXRpb24tbW9kZTpiaWN1YmljO1wiPlxuICAgICAgICAgICAgPC9hPlxuICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgPCEtLSBSaWdodDogQ29weSAtLT5cbiAgICAgICAgICA8dGQgY2xhc3M9XCJzdGFjay1jb2xzXCIgd2lkdGg9XCI1MCVcIiB2YWxpZ249XCJ0b3BcIiBzdHlsZT1cInBhZGRpbmc6MHB4IDBweCAwcHggMTJweDtcIj5cbiAgICAgICAgICAgIDwhLS0gVGl0bGUgLS0+XG4gICAgICAgICAgICA8aDIgc3R5bGU9XCJtYXJnaW46MCAwIDEwcHggMDtmb250LWZhbWlseTpNb250c2VycmF0LEFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2ZvbnQtc2l6ZToyNnB4O2xpbmUtaGVpZ2h0OjEuMjtjb2xvcjojMTExMTExO2ZvbnQtd2VpZ2h0OjMwMDtcIj5cbiAgICAgICAgICAgICAge3t0aXRsZX19XG4gICAgICAgICAgICA8L2gyPlxuICAgICAgICAgICAgPCEtLSBQcmljZSAoc3VwcG9ydHMgb3JpZ2luYWwgcHJpY2UgdmlhIHByaWNlSHRtbCkgLS0+XG4gICAgICAgICAgICA8cCBzdHlsZT1cIm1hcmdpbjowIDAgMTBweCAwO2ZvbnQtZmFtaWx5Ok1vbnRzZXJyYXQsQXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7Zm9udC1zaXplOjE2cHg7bGluZS1oZWlnaHQ6MTtjb2xvcjojMTExMTExO2ZvbnQtd2VpZ2h0OjYwMDtcIj5cbiAgICAgICAgICAgICAge3twcmljZUh0bWx9fVxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPCEtLSBEZXNjcmlwdGlvbiAtLT5cbiAgICAgICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOjAgMCAxNnB4IDA7Zm9udC1mYW1pbHk6TW9udHNlcnJhdCxBcmlhbCxIZWx2ZXRpY2Esc2Fucy1zZXJpZjtmb250LXNpemU6MTRweDtsaW5lLWhlaWdodDoxLjY7Y29sb3I6IzMzMzMzMztcIj5cbiAgICAgICAgICAgICAge3tkZXNjcmlwdGlvbn19XG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8IS0tIENUQSByb3cgLS0+XG4gICAgICAgICAgICA8dGFibGUgcm9sZT1cInByZXNlbnRhdGlvblwiIHdpZHRoPVwiMTAwJVwiIGNlbGxwYWRkaW5nPVwiMFwiIGNlbGxzcGFjaW5nPVwiMFwiIGJvcmRlcj1cIjBcIiBzdHlsZT1cIm1hcmdpbjowO3BhZGRpbmc6MDtcIj5cbiAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgIDx0ZCBhbGlnbj1cImxlZnRcIiB2YWxpZ249XCJtaWRkbGVcIiBzdHlsZT1cInBhZGRpbmc6MDtcIj5cbiAgICAgICAgICAgICAgICAgIDx0YWJsZSByb2xlPVwicHJlc2VudGF0aW9uXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCIgYm9yZGVyPVwiMFwiIHN0eWxlPVwibWFyZ2luOjA7cGFkZGluZzowO1wiIGNsYXNzPVwiY3RhXCI+XG4gICAgICAgICAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgICAgICAgICA8dGQgYWxpZ249XCJjZW50ZXJcIiBiZ2NvbG9yPVwie3tjdGFCZ319XCIgc3R5bGU9XCJiYWNrZ3JvdW5kOnt7Y3RhQmd9fTtcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCJ7e2N0YX19XCIgdGFyZ2V0PVwiX2JsYW5rXCIgc3R5bGU9XCJkaXNwbGF5OmlubGluZS1ibG9jaztwYWRkaW5nOjEycHggMjJweDtmb250LWZhbWlseTpNb250c2VycmF0LEFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxNHB4O2xpbmUtaGVpZ2h0OjE0cHg7Y29sb3I6I2ZmZmZmZjt0ZXh0LWRlY29yYXRpb246bm9uZTtcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge3tjdGFMYWJlbH19XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgICA8IS0tIC9DVEEgcm93IC0tPlxuICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvdHI+XG4gICAgICA8L3RhYmxlPlxuICAgICAgPCEtLSAvVHdvIENvbHVtbnMgLS0+XG4gICAgPC90ZD5cbiAgPC90cj5cbjwvdGFibGU+XG48IS0tID09PSBFbmQ6IFByb2R1Y3QgRmVhdHVyZSBNb2R1bGUgPT09IC0tPlxuPHN0eWxlPlxuQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2MDBweCkge1xuICAuc3RhY2stY29scyB7IGRpc3BsYXk6YmxvY2sgIWltcG9ydGFudDsgd2lkdGg6MTAwJSAhaW1wb3J0YW50OyBwYWRkaW5nOjAgMCAxNnB4IDAgIWltcG9ydGFudDsgfVxuICAubW9kdWxlLXBhZCB7IHBhZGRpbmc6MTJweCAhaW1wb3J0YW50OyB9XG4gIC5jdGEgeyB3aWR0aDoxMDAlICFpbXBvcnRhbnQ7IH1cbn1cbjwvc3R5bGU+YFxuICB9XG4gICwge1xuICAgIGlkOiAnZ3JpZCcsXG4gICAgbmFtZTogJ0dyaWQnLFxuICAgIC8vIEdyaWQgdGVtcGxhdGU6IGRpc3BsYXlzIG9ubHkgcHJvZHVjdCBpbWFnZXMgaW4gYSByZXNwb25zaXZlIGdyaWQsIG5vIHRpdGxlcyBvciBkZXNjcmlwdGlvbnMuXG4gICAgaHRtbDogYDwhLS0gPT09IFN0YXJ0OiBQcm9kdWN0IEdyaWQgTW9kdWxlID09PSAtLT5cbjx0YWJsZSByb2xlPVwicHJlc2VudGF0aW9uXCIgd2lkdGg9XCIxMDAlXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCIgYm9yZGVyPVwiMFwiIGFsaWduPVwiY2VudGVyXCIgc3R5bGU9XCJtYXJnaW46MDtwYWRkaW5nOjA7XCI+XG4gIDx0cj5cbiAgICA8dGQgYWxpZ249XCJjZW50ZXJcIiBzdHlsZT1cIm1hcmdpbjowO3BhZGRpbmc6MDtcIj5cbiAgICAgIDx0YWJsZSByb2xlPVwicHJlc2VudGF0aW9uXCIgd2lkdGg9XCIxMDAlXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCIgYm9yZGVyPVwiMFwiIHN0eWxlPVwibWF4LXdpZHRoOjYwMHB4O21hcmdpbjowIGF1dG87YmFja2dyb3VuZDojRkZGRkZGO1wiPlxuICAgICAgICA8dHI+XG4gICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzowcHg7XCI+XG4gICAgICAgICAgICA8IS0tIFByb2R1Y3QgSW1hZ2VzIEdyaWQgLS0+XG4gICAgICAgICAgICA8dGFibGUgcm9sZT1cInByZXNlbnRhdGlvblwiIHdpZHRoPVwiMTAwJVwiIGNlbGxwYWRkaW5nPVwiMFwiIGNlbGxzcGFjaW5nPVwiMFwiIGJvcmRlcj1cIjBcIiBzdHlsZT1cIndpZHRoOjEwMCU7bWFyZ2luOjA7cGFkZGluZzowO1wiPlxuICAgICAgICAgICAgICA8dHI+XG4gICAgICAgICAgICAgICAge3sjZWFjaCBpbWFnZXN9fVxuICAgICAgICAgICAgICAgIDx0ZCBhbGlnbj1cImNlbnRlclwiIHZhbGlnbj1cInRvcFwiIHN0eWxlPVwicGFkZGluZzowcHg7XCI+XG4gICAgICAgICAgICAgICAgICA8aW1nIHNyYz1cInt7Ln19XCIgYWx0PVwiUHJvZHVjdCBpbWFnZVwiIHN0eWxlPVwiZGlzcGxheTpibG9jazt3aWR0aDoxMDAlO2hlaWdodDphdXRvO2JvcmRlcjowO291dGxpbmU6MDt0ZXh0LWRlY29yYXRpb246bm9uZTstbXMtaW50ZXJwb2xhdGlvbi1tb2RlOmJpY3ViaWM7XCI+XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICB7ey9lYWNofX1cbiAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgICA8IS0tIC9Qcm9kdWN0IEltYWdlcyBHcmlkIC0tPlxuICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvdHI+XG4gICAgICA8L3RhYmxlPlxuICAgIDwvdGQ+XG4gIDwvdHI+XG48L3RhYmxlPlxuPCEtLSA9PT0gRW5kOiBQcm9kdWN0IEdyaWQgTW9kdWxlID09PSAtLT5cbjxzdHlsZT5cbkBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDogNjAwcHgpIHtcbiAgLnByb2R1Y3QtZ3JpZC1pbWcge1xuICAgIHdpZHRoOiA4MHB4ICFpbXBvcnRhbnQ7XG4gICAgcGFkZGluZzogNHB4ICFpbXBvcnRhbnQ7XG4gIH1cbn1cbjwvc3R5bGU+YFxuICB9XG4gICwge1xuICAgIGlkOiAncHJvZHVjdC1jb3B5LWxlZnQtaW1hZ2UtcmlnaHQnLFxuICAgIG5hbWU6ICdDb3B5IGxlZnQgLyBJbWFnZSByaWdodCcsXG4gICAgLy8gU3dhcHBlZCBsYXlvdXQ6IGNvcHkgYXBwZWFycyBvbiB0aGUgbGVmdCBhbmQgaW1hZ2Ugb24gdGhlIHJpZ2h0LiBUaGlzXG4gICAgLy8gdmFyaWFudCBtYXRjaGVzIHRoZSBuZXcgZGVzaWduIGFuZCByZW1vdmVzIHRoZSBwcmV0aXRsZS4gVGhlXG4gICAgLy8gcGxhY2Vob2xkZXIge3twcmljZUh0bWx9fSBzaG91bGQgY29udGFpbiB0aGUgZm9ybWF0dGVkIHByaWNlIHdpdGhcbiAgICAvLyBhbnkgb3JpZ2luYWwgcHJpY2UgaW5jbHVkZWQuXG4gICAgaHRtbDogYDwhLS0gPT09IFN0YXJ0OiBQcm9kdWN0IEZlYXR1cmUgTW9kdWxlIChDb3B5IExlZnQgLyBJbWFnZSBSaWdodCkgPT09IC0tPlxuPHRhYmxlIHJvbGU9XCJwcmVzZW50YXRpb25cIiB3aWR0aD1cIjEwMCVcIiBjZWxscGFkZGluZz1cIjBcIiBjZWxsc3BhY2luZz1cIjBcIiBib3JkZXI9XCIwXCIgYWxpZ249XCJjZW50ZXJcIiBzdHlsZT1cIm1hcmdpbjowO3BhZGRpbmc6MDtcIj5cbiAgPHRyPlxuICAgIDx0ZCBhbGlnbj1cImNlbnRlclwiIHN0eWxlPVwibWFyZ2luOjA7cGFkZGluZzowO1wiPlxuICAgICAgPCEtLSBXcmFwcGVyIGludGVudGlvbmFsbHkgb21pdHRlZCAoaGFuZGxlZCBieSBzZWN0aW9uIHdyYXBwZXIpIC0tPlxuICAgICAgPCEtLSBUd28gQ29sdW1ucyAoY29weSBmaXJzdCwgaW1hZ2Ugc2Vjb25kKSAtLT5cbiAgICAgIDx0YWJsZSByb2xlPVwicHJlc2VudGF0aW9uXCIgd2lkdGg9XCIxMDAlXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCIgYm9yZGVyPVwiMFwiIGNsYXNzPVwibW9kdWxlLXBhZFwiIHN0eWxlPVwid2lkdGg6MTAwJTttYXJnaW46MDtwYWRkaW5nOjI1cHg7XCI+XG4gICAgICAgIDx0cj5cbiAgICAgICAgICA8IS0tIExlZnQ6IENvcHkgLS0+XG4gICAgICAgICAgPHRkIGNsYXNzPVwic3RhY2stY29sc1wiIHdpZHRoPVwiNTAlXCIgdmFsaWduPVwidG9wXCIgc3R5bGU9XCJwYWRkaW5nOjBweCAxMnB4IDBweCAwcHg7XCI+XG4gICAgICAgICAgICA8IS0tIFRpdGxlIC0tPlxuICAgICAgICAgICAgPGgyIHN0eWxlPVwibWFyZ2luOjAgMCAxMHB4IDA7Zm9udC1mYW1pbHk6TW9udHNlcnJhdCxBcmlhbCxIZWx2ZXRpY2Esc2Fucy1zZXJpZjtmb250LXNpemU6MjZweDtsaW5lLWhlaWdodDoxLjI7Y29sb3I6IzExMTExMTtmb250LXdlaWdodDozMDA7XCI+XG4gICAgICAgICAgICAgIHt7dGl0bGV9fVxuICAgICAgICAgICAgPC9oMj5cbiAgICAgICAgICAgIDwhLS0gUHJpY2UgLS0+XG4gICAgICAgICAgICA8cCBzdHlsZT1cIm1hcmdpbjowIDAgMTBweCAwO2ZvbnQtZmFtaWx5Ok1vbnRzZXJyYXQsQXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7Zm9udC1zaXplOjE2cHg7bGluZS1oZWlnaHQ6MTtjb2xvcjojMTExMTExO2ZvbnQtd2VpZ2h0OjYwMDtcIj5cbiAgICAgICAgICAgICAge3twcmljZUh0bWx9fVxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPCEtLSBEZXNjcmlwdGlvbiAtLT5cbiAgICAgICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOjAgMCAxNnB4IDA7Zm9udC1mYW1pbHk6TW9udHNlcnJhdCxBcmlhbCxIZWx2ZXRpY2Esc2Fucy1zZXJpZjtmb250LXNpemU6MTRweDtsaW5lLWhlaWdodDoxLjY7Y29sb3I6IzMzMzMzMztcIj5cbiAgICAgICAgICAgICAge3tkZXNjcmlwdGlvbn19XG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8IS0tIENUQSByb3cgLS0+XG4gICAgICAgICAgICA8dGFibGUgcm9sZT1cInByZXNlbnRhdGlvblwiIHdpZHRoPVwiMTAwJVwiIGNlbGxwYWRkaW5nPVwiMFwiIGNlbGxzcGFjaW5nPVwiMFwiIGJvcmRlcj1cIjBcIiBzdHlsZT1cIm1hcmdpbjowO3BhZGRpbmc6MDtcIj5cbiAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgIDx0ZCBhbGlnbj1cImxlZnRcIiB2YWxpZ249XCJtaWRkbGVcIiBzdHlsZT1cInBhZGRpbmc6MDtcIj5cbiAgICAgICAgICAgICAgICAgIDx0YWJsZSByb2xlPVwicHJlc2VudGF0aW9uXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCIgYm9yZGVyPVwiMFwiIHN0eWxlPVwibWFyZ2luOjA7cGFkZGluZzowO1wiIGNsYXNzPVwiY3RhXCI+XG4gICAgICAgICAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgICAgICAgICA8dGQgYWxpZ249XCJjZW50ZXJcIiBiZ2NvbG9yPVwie3tjdGFCZ319XCIgc3R5bGU9XCJiYWNrZ3JvdW5kOnt7Y3RhQmd9fTtcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCJ7e2N0YX19XCIgdGFyZ2V0PVwiX2JsYW5rXCIgc3R5bGU9XCJkaXNwbGF5OmlubGluZS1ibG9jaztwYWRkaW5nOjEycHggMjJweDtmb250LWZhbWlseTpNb250c2VycmF0LEFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxNHB4O2xpbmUtaGVpZ2h0OjE0cHg7Y29sb3I6I2ZmZmZmZjt0ZXh0LWRlY29yYXRpb246bm9uZTtcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge3tjdGFMYWJlbH19XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgICA8IS0tIC9DVEEgcm93IC0tPlxuICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgPCEtLSBSaWdodDogSW1hZ2UgLS0+XG4gICAgICAgICAgPHRkIGNsYXNzPVwic3RhY2stY29sc1wiIHdpZHRoPVwiNTAlXCIgdmFsaWduPVwidG9wXCIgc3R5bGU9XCJwYWRkaW5nOjBweCAwcHggMHB4IDEycHg7XCI+XG4gICAgICAgICAgICA8YSBocmVmPVwie3tjdGF9fVwiIHRhcmdldD1cIl9ibGFua1wiIHN0eWxlPVwidGV4dC1kZWNvcmF0aW9uOm5vbmU7XCI+XG4gICAgICAgICAgICAgIDxpbWcgc3JjPVwie3tpbWFnZX19XCIgYWx0PVwie3t0aXRsZX19XCIgc3R5bGU9XCJkaXNwbGF5OmJsb2NrO3dpZHRoOjEwMCU7aGVpZ2h0OmF1dG87Ym9yZGVyOjA7b3V0bGluZTowO3RleHQtZGVjb3JhdGlvbjpub25lOy1tcy1pbnRlcnBvbGF0aW9uLW1vZGU6YmljdWJpYztcIj5cbiAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8L3RkPlxuICAgICAgICA8L3RyPlxuICAgICAgPC90YWJsZT5cbiAgICAgIDwhLS0gL1R3byBDb2x1bW5zIC0tPlxuICAgIDwvdGQ+XG4gIDwvdHI+XG48L3RhYmxlPlxuPCEtLSA9PT0gRW5kOiBQcm9kdWN0IEZlYXR1cmUgTW9kdWxlID09PSAtLT5cbjxzdHlsZT5cbkBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDogNjAwcHgpIHtcbiAgLnN0YWNrLWNvbHMgeyBkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnQ7IHdpZHRoOjEwMCUgIWltcG9ydGFudDsgcGFkZGluZzowIDAgMTZweCAwICFpbXBvcnRhbnQ7IH1cbiAgLm1vZHVsZS1wYWQgeyBwYWRkaW5nOjEycHggIWltcG9ydGFudDsgfVxuICAuY3RhIHsgd2lkdGg6MTAwJSAhaW1wb3J0YW50OyB9XG59XG48L3N0eWxlPmBcbiAgfVxuXTtcblxuLyoqXG4gKiBSZW5kZXIgYSB0ZW1wbGF0ZSBpbnRvIGEgY29uY3JldGUgSFRNTCBzdHJpbmcuIFRha2VzIGEgdGVtcGxhdGVcbiAqIGRlZmluaXRpb24gYW5kIGEgcHJvZHVjdCBkYXRhIG9iamVjdCBhbmQgc3Vic3RpdHV0ZXMgZWFjaFxuICogcGxhY2Vob2xkZXIuIFN1cHBvcnRzIGFycmF5cyB2aWEgdGhlIHNpbXBsZSBge3sjZWFjaCBjb2xvdXJzfX1gIHN5bnRheC5cbiAqXG4gKiBUaGlzIGlzIGEgbWluaW1hbCBpbXBsZW1lbnRhdGlvbiBkZWxpYmVyYXRlbHkga2VwdCBzaW1wbGUuIElmIG1vcmVcbiAqIHBvd2VyZnVsIHRlbXBsYXRpbmcgaXMgcmVxdWlyZWQgKGUuZy4gY29uZGl0aW9uYWxzLCBsb29wcykgYVxuICogZGVkaWNhdGVkIHRlbXBsYXRlIGVuZ2luZSBsaWtlIEhhbmRsZWJhcnMgY2FuIGJlIGludHJvZHVjZWQuIEZvclxuICogbm93IG9ubHkgc3Vic3RpdHV0aW9uIGFuZCBiYXNpYyBhcnJheSBpdGVyYXRpb24gaXMgc3VwcG9ydGVkLlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyVGVtcGxhdGUodGVtcGxhdGU6IFRlbXBsYXRlLCBkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogc3RyaW5nIHtcbiAgbGV0IHJlc3VsdCA9IHRlbXBsYXRlLmh0bWw7XG4gIC8vIEhhbmRsZSBhcnJheSBibG9ja3M6IHt7I2VhY2ggY29sb3JzfX0uLi57ey9lYWNofX1cbiAgY29uc3QgZWFjaFJlZ2V4ID0gL1xce1xceyNlYWNoXFxzKyhbYS16QS1aMC05X10rKVxcfX0oW1xcc1xcU10qPylcXHtcXHtcXC9lYWNoXFx9fS9nO1xuICByZXN1bHQgPSByZXN1bHQucmVwbGFjZShlYWNoUmVnZXgsIChfbWF0Y2gsIGtleTogc3RyaW5nLCBpbm5lcjogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgYXJyID0gQXJyYXkuaXNBcnJheShkYXRhW2tleV0pID8gKGRhdGFba2V5XSBhcyBhbnlbXSkgOiBbXTtcbiAgICByZXR1cm4gYXJyXG4gICAgICAubWFwKChpdGVtKSA9PiB7XG4gICAgICAgIC8vIFJlcGxhY2Uge3sufX0gd2l0aGluIHRoZSBpbm5lciBibG9jayB3aXRoIHRoZSBpdGVtIGl0c2VsZi5cbiAgICAgICAgcmV0dXJuIGlubmVyLnJlcGxhY2UoL1xce1xce1xcLlxcfVxcfS9nLCBTdHJpbmcoaXRlbSkpO1xuICAgICAgfSlcbiAgICAgIC5qb2luKCcnKTtcbiAgfSk7XG4gIC8vIFJlcGxhY2Ugc2ltcGxlIHZhcmlhYmxlczoge3t0aXRsZX19XG4gIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9cXHtcXHtcXHMqKFthLXpBLVowLTlfXSspXFxzKlxcfVxcfS9nLCAoX20sIGtleTogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBkYXRhW2tleV07XG4gICAgcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwgPyBTdHJpbmcodmFsdWUpIDogJyc7XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0O1xufVxuIl0sIm5hbWVzIjpbImRlZmF1bHRUZW1wbGF0ZXMiLCJpZCIsIm5hbWUiLCJodG1sIiwicmVuZGVyVGVtcGxhdGUiLCJ0ZW1wbGF0ZSIsImRhdGEiLCJyZXN1bHQiLCJlYWNoUmVnZXgiLCJyZXBsYWNlIiwiX21hdGNoIiwia2V5IiwiaW5uZXIiLCJhcnIiLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJpdGVtIiwiU3RyaW5nIiwiam9pbiIsIl9tIiwidmFsdWUiLCJ1bmRlZmluZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./data/templates.ts\n");

/***/ }),

/***/ "(api)/./lib/parser.ts":
/*!***********************!*\
  !*** ./lib/parser.ts ***!
  \***********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseProduct: () => (/* binding */ parseProduct)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var cheerio__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cheerio */ \"cheerio\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__, cheerio__WEBPACK_IMPORTED_MODULE_1__]);\n([axios__WEBPACK_IMPORTED_MODULE_0__, cheerio__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n/**\n * Shape of the information we care about from a product page.\n *\n * These fields mirror the placeholders used in templates. Some\n * fields are optional because not every page will expose them.\n */ // ProductData type moved to lib/types.ts\n/**\n * Attempt to parse structured JSON-LD data from the page. Many\n * e‑commerce platforms embed an object with the schema.org\n * Product type. This helper extracts it if present.\n */ function parseLdJson($) {\n    const scripts = $('script[type=\"application/ld+json\"]').toArray();\n    for (const el of scripts){\n        const contents = $(el).contents().text();\n        if (!contents) continue;\n        try {\n            const json = JSON.parse(contents.trim());\n            // Sometimes multiple objects are wrapped in an array.\n            const candidates = Array.isArray(json) ? json : [\n                json\n            ];\n            for (const obj of candidates){\n                if (obj[\"@type\"] === \"Product\") {\n                    return obj;\n                }\n            }\n        } catch (_) {\n        // ignore JSON parse errors and continue.\n        }\n    }\n    return null;\n}\n/**\n * Generic helper to extract a meta tag value. It first tries to\n * match the given property on the `meta[property]` attribute (as used\n * by Open Graph), then falls back to `meta[name]`.\n */ function getMeta($, prop) {\n    return $(`meta[property='${prop}']`).attr(\"content\") || $(`meta[name='${prop}']`).attr(\"content\") || null;\n}\n/**\n * Fetch a product page and extract basic fields using heuristics. This\n * function does not attempt to deeply crawl the DOM; instead it relies\n * on Open Graph tags, JSON‑LD and common microdata attributes. If a\n * field cannot be resolved it will be returned as an empty string.\n *\n * If the request fails for whatever reason the resulting object will\n * contain empty strings for all properties except url and cta.\n *\n * @param url Product page URL\n */ async function parseProduct(url) {\n    const clean = (value)=>(value || \"\").toString().trim();\n    // Normalise image URLs (protocol-relative, root-relative, and relative paths)\n    const buildNormaliser = (pageUrl)=>{\n        let origin = \"\";\n        let basePath = \"\";\n        try {\n            const u = new URL(pageUrl);\n            origin = u.origin;\n            basePath = pageUrl.endsWith(\"/\") ? pageUrl : pageUrl.substring(0, pageUrl.lastIndexOf(\"/\") + 1);\n        } catch (_) {}\n        return (raw)=>{\n            const val = (raw || \"\").trim();\n            if (!val) return \"\";\n            if (/^https?:\\/\\//i.test(val)) return val;\n            if (val.startsWith(\"//\")) return `https:${val}`; // assume https for protocol-relative\n            if (val.startsWith(\"/\")) return origin ? origin + val : val; // root-relative\n            return basePath ? basePath + val : val; // relative path\n        };\n    };\n    const normalise = buildNormaliser(url);\n    let html = \"\";\n    try {\n        const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(url, {\n            headers: {\n                // Set a user agent so that some sites don’t block our request.\n                \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0 Safari/537.36\"\n            },\n            // Follow redirects automatically.\n            maxRedirects: 3\n        });\n        html = response.data;\n    } catch (error) {\n        console.error(`Failed to fetch ${url}:`, error instanceof Error ? error.message : error);\n        return {\n            url,\n            pretitle: \"\",\n            title: \"\",\n            price: \"\",\n            description: \"\",\n            image: \"\",\n            images: undefined,\n            cta: url,\n            ctaLabel: \"SHOP NOW\"\n        };\n    }\n    const $ = cheerio__WEBPACK_IMPORTED_MODULE_1__.load(html);\n    // Remove any mega-menu content to avoid polluting extraction\n    try {\n        const reMega = /mega[-_ ]?menu/i;\n        const toRemove = $(\"[class]\").filter((_, el)=>reMega.test($(el).attr(\"class\") || \"\")).toArray();\n        if (toRemove.length) $(toRemove).remove();\n    } catch (_) {}\n    // Attempt to parse JSON‑LD structured data first because it typically\n    // provides the richest information. We fall back to meta tags if\n    // structured data is not present or incomplete.\n    const ld = parseLdJson($) || {};\n    const product = {\n        url,\n        pretitle: \"\",\n        title: \"\",\n        price: \"\",\n        originalPrice: undefined,\n        description: \"\",\n        metadataDescription: undefined,\n        image: \"\",\n        images: undefined,\n        cta: url,\n        // Default call-to-action label. Users can override this in the\n        // preview by editing the CTA text. If not provided, templates\n        // will fall back to this value.\n        ctaLabel: \"SHOP NOW\"\n    };\n    // Title\n    product.title = clean(ld.name) || clean(getMeta($, \"og:title\")) || clean(getMeta($, \"twitter:title\")) || clean($(\"title\").first().text());\n    // Description & metadata description\n    // We distinguish the page's canonical META description (<meta name=\"description\">)\n    // from other potential sources like JSON-LD Product.description or Open Graph / Twitter\n    // descriptions. Per requirement: metadataDescription must originate from the meta tag only.\n    const metaTagDescription = clean(getMeta($, \"description\"));\n    const ldDesc = clean(ld.description);\n    const ogDesc = clean(getMeta($, \"og:description\"));\n    const twitterDesc = clean(getMeta($, \"twitter:description\"));\n    // Assign only the literal <meta name=\"description\"> content to metadataDescription\n    product.metadataDescription = metaTagDescription || undefined;\n    if (metaTagDescription) {\n        product.originalMetadataDescription = metaTagDescription;\n    }\n    // Default user-facing description prefers the meta tag, then structured data, then OG/Twitter.\n    product.description = metaTagDescription || ldDesc || ogDesc || twitterDesc || \"\";\n    // Extract specific description sources from .product__description\n    try {\n        const descRoot = $(\".product__description\").first();\n        if (descRoot && descRoot.length) {\n            const p = descRoot.find(\"p\").first();\n            if (p && p.length) {\n                product.descriptionP = clean(p.text());\n            }\n            const ul = descRoot.find(\"ul\").first();\n            if (ul && ul.length) {\n                // Preserve UL structure as HTML for email preview/template\n                product.descriptionUl = $.html(ul);\n            }\n        }\n    } catch (e) {\n    // ignore extraction errors\n    }\n    // Image\n    const ldImage = Array.isArray(ld.image) ? ld.image[0] : typeof ld.image === \"string\" ? ld.image : undefined;\n    product.image = normalise(clean(ldImage) || clean(getMeta($, \"og:image\")) || clean(getMeta($, \"twitter:image\")) || clean($(\"img\").first().attr(\"src\")));\n    // Price\n    const ldOffers = ld.offers;\n    let ldPrice;\n    if (ldOffers) {\n        if (Array.isArray(ldOffers)) {\n            ldPrice = ldOffers[0]?.price;\n        } else if (typeof ldOffers === \"object\") {\n            ldPrice = ldOffers.price;\n        }\n    }\n    product.price = clean(ldPrice) || clean(getMeta($, \"product:price:amount\")) || clean(getMeta($, \"og:price:amount\")) || // Try to match microdata on sites like Shopify: [itemprop=\"price\"]\n    clean($('[itemprop=\"price\"]').first().text());\n    // Original price: attempt to find a compare‑at or strike‑through price. This\n    // can appear in JSON‑LD as an \"priceSpecification\" with\n    // \"priceCurrency\" and \"value\", or in the DOM as <del> or a span with\n    // class containing \"compare\" or \"strike\". We attempt several heuristics\n    // and take the first numeric value we find. The value returned does\n    // not include the currency symbol.\n    let original;\n    // Check JSON‑LD offers.comparePrice if present\n    if (ldOffers) {\n        // Some schemas nest compareAtPrice or originalPrice\n        const getCompare = (obj)=>{\n            if (!obj) return undefined;\n            return obj.compareAtPrice || obj.originalPrice || obj.priceSpecification?.price;\n        };\n        if (Array.isArray(ldOffers)) {\n            for (const off of ldOffers){\n                const val = getCompare(off);\n                if (val) {\n                    original = clean(val);\n                    break;\n                }\n            }\n        } else if (typeof ldOffers === \"object\") {\n            const val = getCompare(ldOffers);\n            if (val) {\n                original = clean(val);\n            }\n        }\n    }\n    if (!original) {\n        // Look for elements containing a price with a line‑through style or a\n        // class indicating \"compare\" or \"original\". We extract numeric\n        // values (digits and decimal separators).\n        const priceRegex = /([\\d,.]+)\\s*(?:[A-Z]{3})?/;\n        // helper to parse text\n        const parsePriceText = (text)=>{\n            const match = priceRegex.exec(text);\n            return match ? match[1] : undefined;\n        };\n        // Check <del> elements\n        $(\"del, strike\").each((_, el)=>{\n            const text = $(el).text();\n            const val = parsePriceText(text);\n            if (val) {\n                original = clean(val);\n                return false; // break the loop\n            }\n        });\n        // Check elements with class containing compare or original\n        if (!original) {\n            $('[class*=\"compare\"],[class*=\"original\"],[class*=\"strike\"]').each((_, el)=>{\n                const text = $(el).text();\n                const val = parsePriceText(text);\n                if (val) {\n                    original = clean(val);\n                    return false;\n                }\n            });\n        }\n    }\n    // Assign originalPrice if found and different from sale price\n    if (original && original !== product.price) {\n        product.originalPrice = original;\n    }\n    // Pretitle: not widely available. As a heuristic, if the title\n    // contains a hyphen, split the first part as pretitle and the rest\n    // as the actual title.\n    if (product.title && product.title.includes(\" – \")) {\n        const parts = product.title.split(/\\s+–\\s+/);\n        if (parts.length > 1) {\n            product.pretitle = parts[0];\n            product.title = parts.slice(1).join(\" – \");\n        }\n    }\n    // Colour capture removed per refactor; no swatch detection\n    // Images: collect additional image URLs beyond the primary image. We\n    // start with the primary image if it exists. Then search for image\n    // elements that are likely part of the product gallery. Heuristics\n    // include class names containing \"product\", \"gallery\", \"thumb\", or\n    // \"image\". We also accept JSON‑LD image arrays. Only absolute\n    // URLs (http or https) are kept and duplicates removed.\n    const imageSet = new Set();\n    if (product.image) {\n        imageSet.add(product.image);\n    }\n    // Add any additional images from JSON‑LD\n    if (Array.isArray(ld.image)) {\n        for (const img of ld.image){\n            if (typeof img === \"string\") {\n                imageSet.add(normalise(img));\n            }\n        }\n    }\n    // DOM extraction: find images with relevant class hints\n    $(\"img\").each((_, el)=>{\n        const src = normalise($(el).attr(\"src\"));\n        if (!src) return;\n        if (!/\\.(jpe?g|png|gif|webp|avif|svg)(?:[?#].*)?$/i.test(src)) return;\n        // Accept images if they contain certain keywords in their class or id\n        const classes = ($(el).attr(\"class\") || \"\") + \" \" + ($(el).parent().attr(\"class\") || \"\");\n        const ids = ($(el).attr(\"id\") || \"\") + \" \" + ($(el).parent().attr(\"id\") || \"\");\n        const hay = classes + \" \" + ids;\n        if (/product|gallery|thumb|image|slider|carousel/i.test(hay)) {\n            imageSet.add(src);\n        }\n    });\n    // Additional extraction: attempt to fetch the Shopify .js endpoint for\n    // richer product data. Many Shopify stores expose a JSON file at\n    // <product-url>.js which contains an array of image URLs and the\n    // featured image. If the request fails or the response is not JSON,\n    // we silently ignore it. We prefix protocol-relative URLs with\n    // https: to ensure absolute paths. Any images found here are added\n    // to imageSet. This logic mirrors the working implementation from\n    // the provided reference package. It avoids slicing the JSON by\n    // braces and instead lets JSON.parse handle the string.\n    try {\n        const jsUrl = url.endsWith(\".js\") ? url : `${url}.js`;\n        const jsResp = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(jsUrl, {\n            headers: {\n                \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0 Safari/537.36\"\n            },\n            maxRedirects: 3\n        });\n        const jsData = jsResp.data;\n        // If response is a string, attempt to parse JSON; if it's already\n        // an object we can process it directly. Some platforms escape\n        // unicode sequences, but JSON.parse will handle them.\n        const parsedData = typeof jsData === \"string\" ? JSON.parse(jsData) : typeof jsData === \"object\" ? jsData : null;\n        if (parsedData && typeof parsedData === \"object\") {\n            // Extract images array\n            const imgs = parsedData.images;\n            if (Array.isArray(imgs)) {\n                for (const p of imgs){\n                    if (typeof p === \"string\" && p) {\n                        const imgUrl = normalise(p.startsWith(\"//\") ? `https:${p}` : p);\n                        if (imgUrl) {\n                            imageSet.add(imgUrl);\n                        }\n                    }\n                }\n            }\n            // Extract featured image\n            const feat = parsedData.featured_image;\n            if (typeof feat === \"string\" && feat) {\n                const full = normalise(feat.startsWith(\"//\") ? `https:${feat}` : feat);\n                if (full) {\n                    imageSet.add(full);\n                }\n            }\n        }\n    } catch (err) {\n    // Silently ignore errors; the JSON endpoint may not exist or may not\n    // return valid JSON. In such cases we simply rely on images\n    // extracted from the HTML and JSON-LD.\n    }\n    // Assign images array if more than one image is found\n    const imagesArr = Array.from(imageSet);\n    if (imagesArr.length > 0) {\n        // Assign the images directly from imageSet. The imageSet itself\n        // already deduplicates exact URLs while preserving insertion order.\n        // We no longer deduplicate by base path (query parameters) because\n        // some stores use the same base for different images. Instead we\n        // preserve all unique URLs. We still move the primary image to\n        // the front of the array if it exists and is not already first.\n        let deduped = imagesArr;\n        if (product.image) {\n            const index = deduped.findIndex((i)=>i === product.image);\n            if (index > 0) {\n                const [img] = deduped.splice(index, 1);\n                deduped.unshift(img);\n            } else if (index === -1) {\n                deduped.unshift(product.image);\n            }\n        }\n        product.images = deduped;\n    }\n    return product;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcGFyc2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUEwQjtBQUNTO0FBR25DOzs7OztDQUtDLEdBQ0QseUNBQXlDO0FBRXpDOzs7O0NBSUMsR0FDRCxTQUFTRSxZQUFZQyxDQUFxQjtJQUN4QyxNQUFNQyxVQUFVRCxFQUFFLHNDQUFzQ0UsT0FBTztJQUMvRCxLQUFLLE1BQU1DLE1BQU1GLFFBQVM7UUFDeEIsTUFBTUcsV0FBV0osRUFBRUcsSUFBSUMsUUFBUSxHQUFHQyxJQUFJO1FBQ3RDLElBQUksQ0FBQ0QsVUFBVTtRQUNmLElBQUk7WUFDRixNQUFNRSxPQUFPQyxLQUFLQyxLQUFLLENBQUNKLFNBQVNLLElBQUk7WUFDckMsc0RBQXNEO1lBQ3RELE1BQU1DLGFBQWFDLE1BQU1DLE9BQU8sQ0FBQ04sUUFBUUEsT0FBTztnQkFBQ0E7YUFBSztZQUN0RCxLQUFLLE1BQU1PLE9BQU9ILFdBQVk7Z0JBQzVCLElBQUlHLEdBQUcsQ0FBQyxRQUFRLEtBQUssV0FBVztvQkFDOUIsT0FBT0E7Z0JBQ1Q7WUFDRjtRQUNGLEVBQUUsT0FBT0MsR0FBRztRQUNWLHlDQUF5QztRQUMzQztJQUNGO0lBQ0EsT0FBTztBQUNUO0FBRUE7Ozs7Q0FJQyxHQUNELFNBQVNDLFFBQVFmLENBQXFCLEVBQUVnQixJQUFZO0lBQ2xELE9BQ0VoQixFQUFFLENBQUMsZUFBZSxFQUFFZ0IsS0FBSyxFQUFFLENBQUMsRUFBRUMsSUFBSSxDQUFDLGNBQ25DakIsRUFBRSxDQUFDLFdBQVcsRUFBRWdCLEtBQUssRUFBRSxDQUFDLEVBQUVDLElBQUksQ0FBQyxjQUMvQjtBQUVKO0FBRUE7Ozs7Ozs7Ozs7Q0FVQyxHQUNNLGVBQWVDLGFBQWFDLEdBQVc7SUFDNUMsTUFBTUMsUUFBUSxDQUFDQyxRQUNiLENBQUNBLFNBQVMsRUFBQyxFQUFHQyxRQUFRLEdBQUdiLElBQUk7SUFFL0IsOEVBQThFO0lBQzlFLE1BQU1jLGtCQUFrQixDQUFDQztRQUN2QixJQUFJQyxTQUFTO1FBQ2IsSUFBSUMsV0FBVztRQUNmLElBQUk7WUFDRixNQUFNQyxJQUFJLElBQUlDLElBQUlKO1lBQ2xCQyxTQUFTRSxFQUFFRixNQUFNO1lBQ2pCQyxXQUFXRixRQUFRSyxRQUFRLENBQUMsT0FBT0wsVUFBVUEsUUFBUU0sU0FBUyxDQUFDLEdBQUdOLFFBQVFPLFdBQVcsQ0FBQyxPQUFPO1FBQy9GLEVBQUUsT0FBT2pCLEdBQUcsQ0FBQztRQUNiLE9BQU8sQ0FBQ2tCO1lBQ04sTUFBTUMsTUFBTSxDQUFDRCxPQUFPLEVBQUMsRUFBR3ZCLElBQUk7WUFDNUIsSUFBSSxDQUFDd0IsS0FBSyxPQUFPO1lBQ2pCLElBQUksZ0JBQWdCQyxJQUFJLENBQUNELE1BQU0sT0FBT0E7WUFDdEMsSUFBSUEsSUFBSUUsVUFBVSxDQUFDLE9BQU8sT0FBTyxDQUFDLE1BQU0sRUFBRUYsSUFBSSxDQUFDLEVBQUUscUNBQXFDO1lBQ3RGLElBQUlBLElBQUlFLFVBQVUsQ0FBQyxNQUFNLE9BQU9WLFNBQVNBLFNBQVNRLE1BQU1BLEtBQUssZ0JBQWdCO1lBQzdFLE9BQU9QLFdBQVdBLFdBQVdPLE1BQU1BLEtBQUssZ0JBQWdCO1FBQzFEO0lBQ0Y7SUFDQSxNQUFNRyxZQUFZYixnQkFBZ0JKO0lBRWxDLElBQUlrQixPQUFPO0lBQ1gsSUFBSTtRQUNGLE1BQU1DLFdBQVcsTUFBTXpDLGlEQUFTLENBQUNzQixLQUFLO1lBQ3BDcUIsU0FBUztnQkFDUCwrREFBK0Q7Z0JBQy9ELGNBQ0U7WUFDSjtZQUNBLGtDQUFrQztZQUNsQ0MsY0FBYztRQUNoQjtRQUNBSixPQUFPQyxTQUFTSSxJQUFJO0lBQ3RCLEVBQUUsT0FBT0MsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRXhCLElBQUksQ0FBQyxDQUFDLEVBQUV3QixpQkFBaUJFLFFBQVFGLE1BQU1HLE9BQU8sR0FBR0g7UUFDbEYsT0FBTztZQUNMeEI7WUFDQTRCLFVBQVU7WUFDVkMsT0FBTztZQUNQQyxPQUFPO1lBQ1BDLGFBQWE7WUFDYkMsT0FBTztZQUNQQyxRQUFRQztZQUNSQyxLQUFLbkM7WUFDTG9DLFVBQVU7UUFDWjtJQUNGO0lBRUEsTUFBTXZELElBQUlGLHlDQUFZLENBQUN1QztJQUN2Qiw2REFBNkQ7SUFDN0QsSUFBSTtRQUNGLE1BQU1vQixTQUFTO1FBQ2YsTUFBTUMsV0FBVzFELEVBQUUsV0FBVzJELE1BQU0sQ0FBQyxDQUFDN0MsR0FBR1gsS0FBT3NELE9BQU92QixJQUFJLENBQUVsQyxFQUFFRyxJQUFJYyxJQUFJLENBQUMsWUFBWSxLQUFNZixPQUFPO1FBQ2pHLElBQUl3RCxTQUFTRSxNQUFNLEVBQUU1RCxFQUFFMEQsVUFBVUcsTUFBTTtJQUN6QyxFQUFFLE9BQU8vQyxHQUFHLENBQUM7SUFFYixzRUFBc0U7SUFDdEUsaUVBQWlFO0lBQ2pFLGdEQUFnRDtJQUNoRCxNQUFNZ0QsS0FBSy9ELFlBQVlDLE1BQU0sQ0FBQztJQUM5QixNQUFNK0QsVUFBdUI7UUFDM0I1QztRQUNBNEIsVUFBVTtRQUNWQyxPQUFPO1FBQ1BDLE9BQU87UUFDUGUsZUFBZVg7UUFDZkgsYUFBYTtRQUNiZSxxQkFBcUJaO1FBQ3JCRixPQUFPO1FBQ1BDLFFBQVFDO1FBQ1JDLEtBQUtuQztRQUVMLCtEQUErRDtRQUMvRCw4REFBOEQ7UUFDOUQsZ0NBQWdDO1FBQ2hDb0MsVUFBVTtJQUNaO0lBRUEsUUFBUTtJQUNSUSxRQUFRZixLQUFLLEdBQ1g1QixNQUFNMEMsR0FBR0ksSUFBSSxLQUNiOUMsTUFBTUwsUUFBUWYsR0FBRyxnQkFDakJvQixNQUFNTCxRQUFRZixHQUFHLHFCQUNqQm9CLE1BQU1wQixFQUFFLFNBQVNtRSxLQUFLLEdBQUc5RCxJQUFJO0lBRS9CLHFDQUFxQztJQUNyQyxtRkFBbUY7SUFDbkYsd0ZBQXdGO0lBQ3hGLDRGQUE0RjtJQUM1RixNQUFNK0QscUJBQXFCaEQsTUFBTUwsUUFBUWYsR0FBRztJQUM1QyxNQUFNcUUsU0FBU2pELE1BQU0wQyxHQUFHWixXQUFXO0lBQ25DLE1BQU1vQixTQUFTbEQsTUFBTUwsUUFBUWYsR0FBRztJQUNoQyxNQUFNdUUsY0FBY25ELE1BQU1MLFFBQVFmLEdBQUc7SUFFckMsbUZBQW1GO0lBQ25GK0QsUUFBUUUsbUJBQW1CLEdBQUdHLHNCQUFzQmY7SUFDcEQsSUFBSWUsb0JBQW9CO1FBQ3JCTCxRQUFnQlMsMkJBQTJCLEdBQUdKO0lBQ2pEO0lBQ0EsK0ZBQStGO0lBQy9GTCxRQUFRYixXQUFXLEdBQUdrQixzQkFBc0JDLFVBQVVDLFVBQVVDLGVBQWU7SUFFL0Usa0VBQWtFO0lBQ2xFLElBQUk7UUFDRixNQUFNRSxXQUFXekUsRUFBRSx5QkFBeUJtRSxLQUFLO1FBQ2pELElBQUlNLFlBQVlBLFNBQVNiLE1BQU0sRUFBRTtZQUMvQixNQUFNYyxJQUFJRCxTQUFTRSxJQUFJLENBQUMsS0FBS1IsS0FBSztZQUNsQyxJQUFJTyxLQUFLQSxFQUFFZCxNQUFNLEVBQUU7Z0JBQ2pCRyxRQUFRYSxZQUFZLEdBQUd4RCxNQUFNc0QsRUFBRXJFLElBQUk7WUFDckM7WUFDQSxNQUFNd0UsS0FBS0osU0FBU0UsSUFBSSxDQUFDLE1BQU1SLEtBQUs7WUFDcEMsSUFBSVUsTUFBTUEsR0FBR2pCLE1BQU0sRUFBRTtnQkFDbkIsMkRBQTJEO2dCQUMzREcsUUFBUWUsYUFBYSxHQUFHOUUsRUFBRXFDLElBQUksQ0FBQ3dDO1lBQ2pDO1FBQ0Y7SUFDRixFQUFFLE9BQU9FLEdBQUc7SUFDViwyQkFBMkI7SUFDN0I7SUFFQSxRQUFRO0lBQ1IsTUFBTUMsVUFBOEJyRSxNQUFNQyxPQUFPLENBQUNrRCxHQUFHWCxLQUFLLElBQ3REVyxHQUFHWCxLQUFLLENBQUMsRUFBRSxHQUNYLE9BQU9XLEdBQUdYLEtBQUssS0FBSyxXQUNwQlcsR0FBR1gsS0FBSyxHQUNSRTtJQUNKVSxRQUFRWixLQUFLLEdBQUdmLFVBQ2RoQixNQUFNNEQsWUFDSjVELE1BQU1MLFFBQVFmLEdBQUcsZ0JBQ2pCb0IsTUFBTUwsUUFBUWYsR0FBRyxxQkFDakJvQixNQUFNcEIsRUFBRSxPQUFPbUUsS0FBSyxHQUFHbEQsSUFBSSxDQUFDO0lBR2hDLFFBQVE7SUFDUixNQUFNZ0UsV0FBV25CLEdBQUdvQixNQUFNO0lBQzFCLElBQUlDO0lBQ0osSUFBSUYsVUFBVTtRQUNaLElBQUl0RSxNQUFNQyxPQUFPLENBQUNxRSxXQUFXO1lBQzNCRSxVQUFVRixRQUFRLENBQUMsRUFBRSxFQUFFaEM7UUFDekIsT0FBTyxJQUFJLE9BQU9nQyxhQUFhLFVBQVU7WUFDdkNFLFVBQVVGLFNBQVNoQyxLQUFLO1FBQzFCO0lBQ0Y7SUFDQWMsUUFBUWQsS0FBSyxHQUNYN0IsTUFBTStELFlBQ04vRCxNQUFNTCxRQUFRZixHQUFHLDRCQUNqQm9CLE1BQU1MLFFBQVFmLEdBQUcsdUJBQ2pCLG1FQUFtRTtJQUNuRW9CLE1BQU1wQixFQUFFLHNCQUFzQm1FLEtBQUssR0FBRzlELElBQUk7SUFFNUMsNkVBQTZFO0lBQzdFLHdEQUF3RDtJQUN4RCxxRUFBcUU7SUFDckUsd0VBQXdFO0lBQ3hFLG9FQUFvRTtJQUNwRSxtQ0FBbUM7SUFDbkMsSUFBSStFO0lBQ0osK0NBQStDO0lBQy9DLElBQUlILFVBQVU7UUFDWixvREFBb0Q7UUFDcEQsTUFBTUksYUFBYSxDQUFDeEU7WUFDbEIsSUFBSSxDQUFDQSxLQUFLLE9BQU93QztZQUNqQixPQUFPeEMsSUFBSXlFLGNBQWMsSUFBSXpFLElBQUltRCxhQUFhLElBQUluRCxJQUFJMEUsa0JBQWtCLEVBQUV0QztRQUM1RTtRQUNBLElBQUl0QyxNQUFNQyxPQUFPLENBQUNxRSxXQUFXO1lBQzNCLEtBQUssTUFBTU8sT0FBT1AsU0FBVTtnQkFDMUIsTUFBTWhELE1BQU1vRCxXQUFXRztnQkFDdkIsSUFBSXZELEtBQUs7b0JBQ1BtRCxXQUFXaEUsTUFBTWE7b0JBQ2pCO2dCQUNGO1lBQ0Y7UUFDRixPQUFPLElBQUksT0FBT2dELGFBQWEsVUFBVTtZQUN2QyxNQUFNaEQsTUFBTW9ELFdBQVdKO1lBQ3ZCLElBQUloRCxLQUFLO2dCQUNQbUQsV0FBV2hFLE1BQU1hO1lBQ25CO1FBQ0Y7SUFDRjtJQUNBLElBQUksQ0FBQ21ELFVBQVU7UUFDYixzRUFBc0U7UUFDdEUsK0RBQStEO1FBQy9ELDBDQUEwQztRQUMxQyxNQUFNSyxhQUFhO1FBQ25CLHVCQUF1QjtRQUN2QixNQUFNQyxpQkFBaUIsQ0FBQ3JGO1lBQ3RCLE1BQU1zRixRQUFRRixXQUFXRyxJQUFJLENBQUN2RjtZQUM5QixPQUFPc0YsUUFBUUEsS0FBSyxDQUFDLEVBQUUsR0FBR3RDO1FBQzVCO1FBQ0EsdUJBQXVCO1FBQ3ZCckQsRUFBRSxlQUFlNkYsSUFBSSxDQUFDLENBQUMvRSxHQUFHWDtZQUN4QixNQUFNRSxPQUFPTCxFQUFFRyxJQUFJRSxJQUFJO1lBQ3ZCLE1BQU00QixNQUFNeUQsZUFBZXJGO1lBQzNCLElBQUk0QixLQUFLO2dCQUNQbUQsV0FBV2hFLE1BQU1hO2dCQUNqQixPQUFPLE9BQU8saUJBQWlCO1lBQ2pDO1FBQ0Y7UUFDQSwyREFBMkQ7UUFDM0QsSUFBSSxDQUFDbUQsVUFBVTtZQUNicEYsRUFBRSw0REFBNEQ2RixJQUFJLENBQUMsQ0FBQy9FLEdBQUdYO2dCQUNyRSxNQUFNRSxPQUFPTCxFQUFFRyxJQUFJRSxJQUFJO2dCQUN2QixNQUFNNEIsTUFBTXlELGVBQWVyRjtnQkFDM0IsSUFBSTRCLEtBQUs7b0JBQ1BtRCxXQUFXaEUsTUFBTWE7b0JBQ2pCLE9BQU87Z0JBQ1Q7WUFDRjtRQUNGO0lBQ0Y7SUFDQSw4REFBOEQ7SUFDOUQsSUFBSW1ELFlBQVlBLGFBQWFyQixRQUFRZCxLQUFLLEVBQUU7UUFDMUNjLFFBQVFDLGFBQWEsR0FBR29CO0lBQzFCO0lBRUEsK0RBQStEO0lBQy9ELG1FQUFtRTtJQUNuRSx1QkFBdUI7SUFDdkIsSUFBSXJCLFFBQVFmLEtBQUssSUFBSWUsUUFBUWYsS0FBSyxDQUFDOEMsUUFBUSxDQUFDLFFBQVE7UUFDbEQsTUFBTUMsUUFBUWhDLFFBQVFmLEtBQUssQ0FBQ2dELEtBQUssQ0FBQztRQUNsQyxJQUFJRCxNQUFNbkMsTUFBTSxHQUFHLEdBQUc7WUFDcEJHLFFBQVFoQixRQUFRLEdBQUdnRCxLQUFLLENBQUMsRUFBRTtZQUMzQmhDLFFBQVFmLEtBQUssR0FBRytDLE1BQU1FLEtBQUssQ0FBQyxHQUFHQyxJQUFJLENBQUM7UUFDdEM7SUFDRjtJQUVBLDJEQUEyRDtJQUUzRCxxRUFBcUU7SUFDckUsbUVBQW1FO0lBQ25FLG1FQUFtRTtJQUNuRSxtRUFBbUU7SUFDbkUsOERBQThEO0lBQzlELHdEQUF3RDtJQUN4RCxNQUFNQyxXQUFXLElBQUlDO0lBQ3JCLElBQUlyQyxRQUFRWixLQUFLLEVBQUU7UUFDakJnRCxTQUFTRSxHQUFHLENBQUN0QyxRQUFRWixLQUFLO0lBQzVCO0lBQ0EseUNBQXlDO0lBQ3pDLElBQUl4QyxNQUFNQyxPQUFPLENBQUNrRCxHQUFHWCxLQUFLLEdBQUc7UUFDM0IsS0FBSyxNQUFNbUQsT0FBT3hDLEdBQUdYLEtBQUssQ0FBRTtZQUMxQixJQUFJLE9BQU9tRCxRQUFRLFVBQVU7Z0JBQzNCSCxTQUFTRSxHQUFHLENBQUNqRSxVQUFVa0U7WUFDekI7UUFDRjtJQUNGO0lBQ0Esd0RBQXdEO0lBQ3hEdEcsRUFBRSxPQUFPNkYsSUFBSSxDQUFDLENBQUMvRSxHQUFHWDtRQUNoQixNQUFNb0csTUFBTW5FLFVBQVVwQyxFQUFFRyxJQUFJYyxJQUFJLENBQUM7UUFDakMsSUFBSSxDQUFDc0YsS0FBSztRQUNWLElBQUksQ0FBQywrQ0FBK0NyRSxJQUFJLENBQUNxRSxNQUFNO1FBQy9ELHNFQUFzRTtRQUN0RSxNQUFNQyxVQUFVLENBQUN4RyxFQUFFRyxJQUFJYyxJQUFJLENBQUMsWUFBWSxFQUFDLElBQUssTUFBT2pCLENBQUFBLEVBQUVHLElBQUlzRyxNQUFNLEdBQUd4RixJQUFJLENBQUMsWUFBWSxFQUFDO1FBQ3RGLE1BQU15RixNQUFNLENBQUMxRyxFQUFFRyxJQUFJYyxJQUFJLENBQUMsU0FBUyxFQUFDLElBQUssTUFBT2pCLENBQUFBLEVBQUVHLElBQUlzRyxNQUFNLEdBQUd4RixJQUFJLENBQUMsU0FBUyxFQUFDO1FBQzVFLE1BQU0wRixNQUFNSCxVQUFVLE1BQU1FO1FBQzVCLElBQUksK0NBQStDeEUsSUFBSSxDQUFDeUUsTUFBTTtZQUM1RFIsU0FBU0UsR0FBRyxDQUFDRTtRQUNmO0lBQ0Y7SUFFQSx1RUFBdUU7SUFDdkUsaUVBQWlFO0lBQ2pFLGlFQUFpRTtJQUNqRSxvRUFBb0U7SUFDcEUsK0RBQStEO0lBQy9ELG1FQUFtRTtJQUNuRSxrRUFBa0U7SUFDbEUsZ0VBQWdFO0lBQ2hFLHdEQUF3RDtJQUN4RCxJQUFJO1FBQ0YsTUFBTUssUUFBUXpGLElBQUlVLFFBQVEsQ0FBQyxTQUFTVixNQUFNLENBQUMsRUFBRUEsSUFBSSxHQUFHLENBQUM7UUFDckQsTUFBTTBGLFNBQVMsTUFBTWhILGlEQUFTLENBQUMrRyxPQUFPO1lBQ3BDcEUsU0FBUztnQkFDUCxjQUNFO1lBQ0o7WUFDQUMsY0FBYztRQUNoQjtRQUNBLE1BQU1xRSxTQUFTRCxPQUFPbkUsSUFBSTtRQUMxQixrRUFBa0U7UUFDbEUsOERBQThEO1FBQzlELHNEQUFzRDtRQUN0RCxNQUFNcUUsYUFDSixPQUFPRCxXQUFXLFdBQ2R2RyxLQUFLQyxLQUFLLENBQUNzRyxVQUNYLE9BQU9BLFdBQVcsV0FDbEJBLFNBQ0E7UUFDTixJQUFJQyxjQUFjLE9BQU9BLGVBQWUsVUFBVTtZQUNoRCx1QkFBdUI7WUFDdkIsTUFBTUMsT0FBZ0IsV0FBb0I1RCxNQUFNO1lBQ2hELElBQUl6QyxNQUFNQyxPQUFPLENBQUNvRyxPQUFPO2dCQUN2QixLQUFLLE1BQU10QyxLQUFLc0MsS0FBTTtvQkFDcEIsSUFBSSxPQUFPdEMsTUFBTSxZQUFZQSxHQUFHO3dCQUM5QixNQUFNdUMsU0FBUzdFLFVBQVVzQyxFQUFFdkMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUV1QyxFQUFFLENBQUMsR0FBR0E7d0JBQzdELElBQUl1QyxRQUFROzRCQUNWZCxTQUFTRSxHQUFHLENBQUNZO3dCQUNmO29CQUNGO2dCQUNGO1lBQ0Y7WUFDQSx5QkFBeUI7WUFDekIsTUFBTUMsT0FBZ0IsV0FBb0JDLGNBQWM7WUFDeEQsSUFBSSxPQUFPRCxTQUFTLFlBQVlBLE1BQU07Z0JBQ3BDLE1BQU1FLE9BQU9oRixVQUFVOEUsS0FBSy9FLFVBQVUsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFK0UsS0FBSyxDQUFDLEdBQUdBO2dCQUNqRSxJQUFJRSxNQUFNO29CQUNSakIsU0FBU0UsR0FBRyxDQUFDZTtnQkFDZjtZQUNGO1FBQ0Y7SUFDRixFQUFFLE9BQU9DLEtBQUs7SUFDWixxRUFBcUU7SUFDckUsNERBQTREO0lBQzVELHVDQUF1QztJQUN6QztJQUNBLHNEQUFzRDtJQUN0RCxNQUFNQyxZQUFZM0csTUFBTTRHLElBQUksQ0FBQ3BCO0lBQzdCLElBQUltQixVQUFVMUQsTUFBTSxHQUFHLEdBQUc7UUFDeEIsZ0VBQWdFO1FBQ2hFLG9FQUFvRTtRQUNwRSxtRUFBbUU7UUFDbkUsaUVBQWlFO1FBQ2pFLCtEQUErRDtRQUMvRCxnRUFBZ0U7UUFDaEUsSUFBSTRELFVBQW9CRjtRQUN4QixJQUFJdkQsUUFBUVosS0FBSyxFQUFFO1lBQ2pCLE1BQU1zRSxRQUFRRCxRQUFRRSxTQUFTLENBQUMsQ0FBQ0MsSUFBTUEsTUFBTTVELFFBQVFaLEtBQUs7WUFDMUQsSUFBSXNFLFFBQVEsR0FBRztnQkFDYixNQUFNLENBQUNuQixJQUFJLEdBQUdrQixRQUFRSSxNQUFNLENBQUNILE9BQU87Z0JBQ3BDRCxRQUFRSyxPQUFPLENBQUN2QjtZQUNsQixPQUFPLElBQUltQixVQUFVLENBQUMsR0FBRztnQkFDdkJELFFBQVFLLE9BQU8sQ0FBQzlELFFBQVFaLEtBQUs7WUFDL0I7UUFDRjtRQUNBWSxRQUFRWCxNQUFNLEdBQUdvRTtJQUNuQjtJQUVBLE9BQU96RDtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWRtLWJ1aWxkZXIvLi9saWIvcGFyc2VyLnRzPzRhNjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCAqIGFzIGNoZWVyaW8gZnJvbSAnY2hlZXJpbyc7XG5pbXBvcnQgeyBQcm9kdWN0RGF0YSB9IGZyb20gJy4vdHlwZXMnO1xuXG4vKipcbiAqIFNoYXBlIG9mIHRoZSBpbmZvcm1hdGlvbiB3ZSBjYXJlIGFib3V0IGZyb20gYSBwcm9kdWN0IHBhZ2UuXG4gKlxuICogVGhlc2UgZmllbGRzIG1pcnJvciB0aGUgcGxhY2Vob2xkZXJzIHVzZWQgaW4gdGVtcGxhdGVzLiBTb21lXG4gKiBmaWVsZHMgYXJlIG9wdGlvbmFsIGJlY2F1c2Ugbm90IGV2ZXJ5IHBhZ2Ugd2lsbCBleHBvc2UgdGhlbS5cbiAqL1xuLy8gUHJvZHVjdERhdGEgdHlwZSBtb3ZlZCB0byBsaWIvdHlwZXMudHNcblxuLyoqXG4gKiBBdHRlbXB0IHRvIHBhcnNlIHN0cnVjdHVyZWQgSlNPTi1MRCBkYXRhIGZyb20gdGhlIHBhZ2UuIE1hbnlcbiAqIGXigJFjb21tZXJjZSBwbGF0Zm9ybXMgZW1iZWQgYW4gb2JqZWN0IHdpdGggdGhlIHNjaGVtYS5vcmdcbiAqIFByb2R1Y3QgdHlwZS4gVGhpcyBoZWxwZXIgZXh0cmFjdHMgaXQgaWYgcHJlc2VudC5cbiAqL1xuZnVuY3Rpb24gcGFyc2VMZEpzb24oJDogY2hlZXJpby5DaGVlcmlvQVBJKTogUmVjb3JkPHN0cmluZywgYW55PiB8IG51bGwge1xuICBjb25zdCBzY3JpcHRzID0gJCgnc2NyaXB0W3R5cGU9XCJhcHBsaWNhdGlvbi9sZCtqc29uXCJdJykudG9BcnJheSgpO1xuICBmb3IgKGNvbnN0IGVsIG9mIHNjcmlwdHMpIHtcbiAgICBjb25zdCBjb250ZW50cyA9ICQoZWwpLmNvbnRlbnRzKCkudGV4dCgpO1xuICAgIGlmICghY29udGVudHMpIGNvbnRpbnVlO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShjb250ZW50cy50cmltKCkpO1xuICAgICAgLy8gU29tZXRpbWVzIG11bHRpcGxlIG9iamVjdHMgYXJlIHdyYXBwZWQgaW4gYW4gYXJyYXkuXG4gICAgICBjb25zdCBjYW5kaWRhdGVzID0gQXJyYXkuaXNBcnJheShqc29uKSA/IGpzb24gOiBbanNvbl07XG4gICAgICBmb3IgKGNvbnN0IG9iaiBvZiBjYW5kaWRhdGVzKSB7XG4gICAgICAgIGlmIChvYmpbJ0B0eXBlJ10gPT09ICdQcm9kdWN0Jykge1xuICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChfKSB7XG4gICAgICAvLyBpZ25vcmUgSlNPTiBwYXJzZSBlcnJvcnMgYW5kIGNvbnRpbnVlLlxuICAgIH1cbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBHZW5lcmljIGhlbHBlciB0byBleHRyYWN0IGEgbWV0YSB0YWcgdmFsdWUuIEl0IGZpcnN0IHRyaWVzIHRvXG4gKiBtYXRjaCB0aGUgZ2l2ZW4gcHJvcGVydHkgb24gdGhlIGBtZXRhW3Byb3BlcnR5XWAgYXR0cmlidXRlIChhcyB1c2VkXG4gKiBieSBPcGVuIEdyYXBoKSwgdGhlbiBmYWxscyBiYWNrIHRvIGBtZXRhW25hbWVdYC5cbiAqL1xuZnVuY3Rpb24gZ2V0TWV0YSgkOiBjaGVlcmlvLkNoZWVyaW9BUEksIHByb3A6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuICByZXR1cm4gKFxuICAgICQoYG1ldGFbcHJvcGVydHk9JyR7cHJvcH0nXWApLmF0dHIoJ2NvbnRlbnQnKSB8fFxuICAgICQoYG1ldGFbbmFtZT0nJHtwcm9wfSddYCkuYXR0cignY29udGVudCcpIHx8XG4gICAgbnVsbFxuICApO1xufVxuXG4vKipcbiAqIEZldGNoIGEgcHJvZHVjdCBwYWdlIGFuZCBleHRyYWN0IGJhc2ljIGZpZWxkcyB1c2luZyBoZXVyaXN0aWNzLiBUaGlzXG4gKiBmdW5jdGlvbiBkb2VzIG5vdCBhdHRlbXB0IHRvIGRlZXBseSBjcmF3bCB0aGUgRE9NOyBpbnN0ZWFkIGl0IHJlbGllc1xuICogb24gT3BlbiBHcmFwaCB0YWdzLCBKU09O4oCRTEQgYW5kIGNvbW1vbiBtaWNyb2RhdGEgYXR0cmlidXRlcy4gSWYgYVxuICogZmllbGQgY2Fubm90IGJlIHJlc29sdmVkIGl0IHdpbGwgYmUgcmV0dXJuZWQgYXMgYW4gZW1wdHkgc3RyaW5nLlxuICpcbiAqIElmIHRoZSByZXF1ZXN0IGZhaWxzIGZvciB3aGF0ZXZlciByZWFzb24gdGhlIHJlc3VsdGluZyBvYmplY3Qgd2lsbFxuICogY29udGFpbiBlbXB0eSBzdHJpbmdzIGZvciBhbGwgcHJvcGVydGllcyBleGNlcHQgdXJsIGFuZCBjdGEuXG4gKlxuICogQHBhcmFtIHVybCBQcm9kdWN0IHBhZ2UgVVJMXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwYXJzZVByb2R1Y3QodXJsOiBzdHJpbmcpOiBQcm9taXNlPFByb2R1Y3REYXRhPiB7XG4gIGNvbnN0IGNsZWFuID0gKHZhbHVlOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogc3RyaW5nID0+XG4gICAgKHZhbHVlIHx8ICcnKS50b1N0cmluZygpLnRyaW0oKTtcblxuICAvLyBOb3JtYWxpc2UgaW1hZ2UgVVJMcyAocHJvdG9jb2wtcmVsYXRpdmUsIHJvb3QtcmVsYXRpdmUsIGFuZCByZWxhdGl2ZSBwYXRocylcbiAgY29uc3QgYnVpbGROb3JtYWxpc2VyID0gKHBhZ2VVcmw6IHN0cmluZykgPT4ge1xuICAgIGxldCBvcmlnaW4gPSAnJztcbiAgICBsZXQgYmFzZVBhdGggPSAnJztcbiAgICB0cnkge1xuICAgICAgY29uc3QgdSA9IG5ldyBVUkwocGFnZVVybCk7XG4gICAgICBvcmlnaW4gPSB1Lm9yaWdpbjtcbiAgICAgIGJhc2VQYXRoID0gcGFnZVVybC5lbmRzV2l0aCgnLycpID8gcGFnZVVybCA6IHBhZ2VVcmwuc3Vic3RyaW5nKDAsIHBhZ2VVcmwubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgIH0gY2F0Y2ggKF8pIHt9XG4gICAgcmV0dXJuIChyYXc6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpOiBzdHJpbmcgPT4ge1xuICAgICAgY29uc3QgdmFsID0gKHJhdyB8fCAnJykudHJpbSgpO1xuICAgICAgaWYgKCF2YWwpIHJldHVybiAnJztcbiAgICAgIGlmICgvXmh0dHBzPzpcXC9cXC8vaS50ZXN0KHZhbCkpIHJldHVybiB2YWw7XG4gICAgICBpZiAodmFsLnN0YXJ0c1dpdGgoJy8vJykpIHJldHVybiBgaHR0cHM6JHt2YWx9YDsgLy8gYXNzdW1lIGh0dHBzIGZvciBwcm90b2NvbC1yZWxhdGl2ZVxuICAgICAgaWYgKHZhbC5zdGFydHNXaXRoKCcvJykpIHJldHVybiBvcmlnaW4gPyBvcmlnaW4gKyB2YWwgOiB2YWw7IC8vIHJvb3QtcmVsYXRpdmVcbiAgICAgIHJldHVybiBiYXNlUGF0aCA/IGJhc2VQYXRoICsgdmFsIDogdmFsOyAvLyByZWxhdGl2ZSBwYXRoXG4gICAgfTtcbiAgfTtcbiAgY29uc3Qgbm9ybWFsaXNlID0gYnVpbGROb3JtYWxpc2VyKHVybCk7XG5cbiAgbGV0IGh0bWwgPSAnJztcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldCh1cmwsIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgLy8gU2V0IGEgdXNlciBhZ2VudCBzbyB0aGF0IHNvbWUgc2l0ZXMgZG9u4oCZdCBibG9jayBvdXIgcmVxdWVzdC5cbiAgICAgICAgJ1VzZXItQWdlbnQnOlxuICAgICAgICAgICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTE2LjAgU2FmYXJpLzUzNy4zNidcbiAgICAgIH0sXG4gICAgICAvLyBGb2xsb3cgcmVkaXJlY3RzIGF1dG9tYXRpY2FsbHkuXG4gICAgICBtYXhSZWRpcmVjdHM6IDNcbiAgICB9KTtcbiAgICBodG1sID0gcmVzcG9uc2UuZGF0YTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggJHt1cmx9OmAsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICB1cmwsXG4gICAgICBwcmV0aXRsZTogJycsXG4gICAgICB0aXRsZTogJycsXG4gICAgICBwcmljZTogJycsXG4gICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICBpbWFnZTogJycsXG4gICAgICBpbWFnZXM6IHVuZGVmaW5lZCxcbiAgICAgIGN0YTogdXJsLFxuICAgICAgY3RhTGFiZWw6ICdTSE9QIE5PVydcbiAgICB9IGFzIFByb2R1Y3REYXRhO1xuICB9XG5cbiAgY29uc3QgJCA9IGNoZWVyaW8ubG9hZChodG1sKTtcbiAgLy8gUmVtb3ZlIGFueSBtZWdhLW1lbnUgY29udGVudCB0byBhdm9pZCBwb2xsdXRpbmcgZXh0cmFjdGlvblxuICB0cnkge1xuICAgIGNvbnN0IHJlTWVnYSA9IC9tZWdhWy1fIF0/bWVudS9pO1xuICAgIGNvbnN0IHRvUmVtb3ZlID0gJCgnW2NsYXNzXScpLmZpbHRlcigoXywgZWwpID0+IHJlTWVnYS50ZXN0KCgkKGVsKS5hdHRyKCdjbGFzcycpIHx8ICcnKSkpLnRvQXJyYXkoKTtcbiAgICBpZiAodG9SZW1vdmUubGVuZ3RoKSAkKHRvUmVtb3ZlKS5yZW1vdmUoKTtcbiAgfSBjYXRjaCAoXykge31cblxuICAvLyBBdHRlbXB0IHRvIHBhcnNlIEpTT07igJFMRCBzdHJ1Y3R1cmVkIGRhdGEgZmlyc3QgYmVjYXVzZSBpdCB0eXBpY2FsbHlcbiAgLy8gcHJvdmlkZXMgdGhlIHJpY2hlc3QgaW5mb3JtYXRpb24uIFdlIGZhbGwgYmFjayB0byBtZXRhIHRhZ3MgaWZcbiAgLy8gc3RydWN0dXJlZCBkYXRhIGlzIG5vdCBwcmVzZW50IG9yIGluY29tcGxldGUuXG4gIGNvbnN0IGxkID0gcGFyc2VMZEpzb24oJCkgfHwge307XG4gIGNvbnN0IHByb2R1Y3Q6IFByb2R1Y3REYXRhID0ge1xuICAgIHVybCxcbiAgICBwcmV0aXRsZTogJycsXG4gICAgdGl0bGU6ICcnLFxuICAgIHByaWNlOiAnJyxcbiAgICBvcmlnaW5hbFByaWNlOiB1bmRlZmluZWQsXG4gICAgZGVzY3JpcHRpb246ICcnLFxuICAgIG1ldGFkYXRhRGVzY3JpcHRpb246IHVuZGVmaW5lZCxcbiAgICBpbWFnZTogJycsXG4gICAgaW1hZ2VzOiB1bmRlZmluZWQsXG4gICAgY3RhOiB1cmxcbiAgICAsXG4gICAgLy8gRGVmYXVsdCBjYWxsLXRvLWFjdGlvbiBsYWJlbC4gVXNlcnMgY2FuIG92ZXJyaWRlIHRoaXMgaW4gdGhlXG4gICAgLy8gcHJldmlldyBieSBlZGl0aW5nIHRoZSBDVEEgdGV4dC4gSWYgbm90IHByb3ZpZGVkLCB0ZW1wbGF0ZXNcbiAgICAvLyB3aWxsIGZhbGwgYmFjayB0byB0aGlzIHZhbHVlLlxuICAgIGN0YUxhYmVsOiAnU0hPUCBOT1cnXG4gIH07XG5cbiAgLy8gVGl0bGVcbiAgcHJvZHVjdC50aXRsZSA9XG4gICAgY2xlYW4obGQubmFtZSkgfHxcbiAgICBjbGVhbihnZXRNZXRhKCQsICdvZzp0aXRsZScpKSB8fFxuICAgIGNsZWFuKGdldE1ldGEoJCwgJ3R3aXR0ZXI6dGl0bGUnKSkgfHxcbiAgICBjbGVhbigkKCd0aXRsZScpLmZpcnN0KCkudGV4dCgpKTtcblxuICAvLyBEZXNjcmlwdGlvbiAmIG1ldGFkYXRhIGRlc2NyaXB0aW9uXG4gIC8vIFdlIGRpc3Rpbmd1aXNoIHRoZSBwYWdlJ3MgY2Fub25pY2FsIE1FVEEgZGVzY3JpcHRpb24gKDxtZXRhIG5hbWU9XCJkZXNjcmlwdGlvblwiPilcbiAgLy8gZnJvbSBvdGhlciBwb3RlbnRpYWwgc291cmNlcyBsaWtlIEpTT04tTEQgUHJvZHVjdC5kZXNjcmlwdGlvbiBvciBPcGVuIEdyYXBoIC8gVHdpdHRlclxuICAvLyBkZXNjcmlwdGlvbnMuIFBlciByZXF1aXJlbWVudDogbWV0YWRhdGFEZXNjcmlwdGlvbiBtdXN0IG9yaWdpbmF0ZSBmcm9tIHRoZSBtZXRhIHRhZyBvbmx5LlxuICBjb25zdCBtZXRhVGFnRGVzY3JpcHRpb24gPSBjbGVhbihnZXRNZXRhKCQsICdkZXNjcmlwdGlvbicpKTtcbiAgY29uc3QgbGREZXNjID0gY2xlYW4obGQuZGVzY3JpcHRpb24pO1xuICBjb25zdCBvZ0Rlc2MgPSBjbGVhbihnZXRNZXRhKCQsICdvZzpkZXNjcmlwdGlvbicpKTtcbiAgY29uc3QgdHdpdHRlckRlc2MgPSBjbGVhbihnZXRNZXRhKCQsICd0d2l0dGVyOmRlc2NyaXB0aW9uJykpO1xuXG4gIC8vIEFzc2lnbiBvbmx5IHRoZSBsaXRlcmFsIDxtZXRhIG5hbWU9XCJkZXNjcmlwdGlvblwiPiBjb250ZW50IHRvIG1ldGFkYXRhRGVzY3JpcHRpb25cbiAgcHJvZHVjdC5tZXRhZGF0YURlc2NyaXB0aW9uID0gbWV0YVRhZ0Rlc2NyaXB0aW9uIHx8IHVuZGVmaW5lZDtcbiAgaWYgKG1ldGFUYWdEZXNjcmlwdGlvbikge1xuICAgIChwcm9kdWN0IGFzIGFueSkub3JpZ2luYWxNZXRhZGF0YURlc2NyaXB0aW9uID0gbWV0YVRhZ0Rlc2NyaXB0aW9uO1xuICB9XG4gIC8vIERlZmF1bHQgdXNlci1mYWNpbmcgZGVzY3JpcHRpb24gcHJlZmVycyB0aGUgbWV0YSB0YWcsIHRoZW4gc3RydWN0dXJlZCBkYXRhLCB0aGVuIE9HL1R3aXR0ZXIuXG4gIHByb2R1Y3QuZGVzY3JpcHRpb24gPSBtZXRhVGFnRGVzY3JpcHRpb24gfHwgbGREZXNjIHx8IG9nRGVzYyB8fCB0d2l0dGVyRGVzYyB8fCAnJztcblxuICAvLyBFeHRyYWN0IHNwZWNpZmljIGRlc2NyaXB0aW9uIHNvdXJjZXMgZnJvbSAucHJvZHVjdF9fZGVzY3JpcHRpb25cbiAgdHJ5IHtcbiAgICBjb25zdCBkZXNjUm9vdCA9ICQoJy5wcm9kdWN0X19kZXNjcmlwdGlvbicpLmZpcnN0KCk7XG4gICAgaWYgKGRlc2NSb290ICYmIGRlc2NSb290Lmxlbmd0aCkge1xuICAgICAgY29uc3QgcCA9IGRlc2NSb290LmZpbmQoJ3AnKS5maXJzdCgpO1xuICAgICAgaWYgKHAgJiYgcC5sZW5ndGgpIHtcbiAgICAgICAgcHJvZHVjdC5kZXNjcmlwdGlvblAgPSBjbGVhbihwLnRleHQoKSk7XG4gICAgICB9XG4gICAgICBjb25zdCB1bCA9IGRlc2NSb290LmZpbmQoJ3VsJykuZmlyc3QoKTtcbiAgICAgIGlmICh1bCAmJiB1bC5sZW5ndGgpIHtcbiAgICAgICAgLy8gUHJlc2VydmUgVUwgc3RydWN0dXJlIGFzIEhUTUwgZm9yIGVtYWlsIHByZXZpZXcvdGVtcGxhdGVcbiAgICAgICAgcHJvZHVjdC5kZXNjcmlwdGlvblVsID0gJC5odG1sKHVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBpZ25vcmUgZXh0cmFjdGlvbiBlcnJvcnNcbiAgfVxuXG4gIC8vIEltYWdlXG4gIGNvbnN0IGxkSW1hZ2U6IHN0cmluZyB8IHVuZGVmaW5lZCA9IEFycmF5LmlzQXJyYXkobGQuaW1hZ2UpXG4gICAgPyBsZC5pbWFnZVswXVxuICAgIDogdHlwZW9mIGxkLmltYWdlID09PSAnc3RyaW5nJ1xuICAgID8gbGQuaW1hZ2VcbiAgICA6IHVuZGVmaW5lZDtcbiAgcHJvZHVjdC5pbWFnZSA9IG5vcm1hbGlzZShcbiAgICBjbGVhbihsZEltYWdlKSB8fFxuICAgICAgY2xlYW4oZ2V0TWV0YSgkLCAnb2c6aW1hZ2UnKSkgfHxcbiAgICAgIGNsZWFuKGdldE1ldGEoJCwgJ3R3aXR0ZXI6aW1hZ2UnKSkgfHxcbiAgICAgIGNsZWFuKCQoJ2ltZycpLmZpcnN0KCkuYXR0cignc3JjJykpXG4gICk7XG5cbiAgLy8gUHJpY2VcbiAgY29uc3QgbGRPZmZlcnMgPSBsZC5vZmZlcnM7XG4gIGxldCBsZFByaWNlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGlmIChsZE9mZmVycykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGxkT2ZmZXJzKSkge1xuICAgICAgbGRQcmljZSA9IGxkT2ZmZXJzWzBdPy5wcmljZTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBsZE9mZmVycyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGxkUHJpY2UgPSBsZE9mZmVycy5wcmljZTtcbiAgICB9XG4gIH1cbiAgcHJvZHVjdC5wcmljZSA9XG4gICAgY2xlYW4obGRQcmljZSkgfHxcbiAgICBjbGVhbihnZXRNZXRhKCQsICdwcm9kdWN0OnByaWNlOmFtb3VudCcpKSB8fFxuICAgIGNsZWFuKGdldE1ldGEoJCwgJ29nOnByaWNlOmFtb3VudCcpKSB8fFxuICAgIC8vIFRyeSB0byBtYXRjaCBtaWNyb2RhdGEgb24gc2l0ZXMgbGlrZSBTaG9waWZ5OiBbaXRlbXByb3A9XCJwcmljZVwiXVxuICAgIGNsZWFuKCQoJ1tpdGVtcHJvcD1cInByaWNlXCJdJykuZmlyc3QoKS50ZXh0KCkpO1xuXG4gIC8vIE9yaWdpbmFsIHByaWNlOiBhdHRlbXB0IHRvIGZpbmQgYSBjb21wYXJl4oCRYXQgb3Igc3RyaWtl4oCRdGhyb3VnaCBwcmljZS4gVGhpc1xuICAvLyBjYW4gYXBwZWFyIGluIEpTT07igJFMRCBhcyBhbiBcInByaWNlU3BlY2lmaWNhdGlvblwiIHdpdGhcbiAgLy8gXCJwcmljZUN1cnJlbmN5XCIgYW5kIFwidmFsdWVcIiwgb3IgaW4gdGhlIERPTSBhcyA8ZGVsPiBvciBhIHNwYW4gd2l0aFxuICAvLyBjbGFzcyBjb250YWluaW5nIFwiY29tcGFyZVwiIG9yIFwic3RyaWtlXCIuIFdlIGF0dGVtcHQgc2V2ZXJhbCBoZXVyaXN0aWNzXG4gIC8vIGFuZCB0YWtlIHRoZSBmaXJzdCBudW1lcmljIHZhbHVlIHdlIGZpbmQuIFRoZSB2YWx1ZSByZXR1cm5lZCBkb2VzXG4gIC8vIG5vdCBpbmNsdWRlIHRoZSBjdXJyZW5jeSBzeW1ib2wuXG4gIGxldCBvcmlnaW5hbDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAvLyBDaGVjayBKU09O4oCRTEQgb2ZmZXJzLmNvbXBhcmVQcmljZSBpZiBwcmVzZW50XG4gIGlmIChsZE9mZmVycykge1xuICAgIC8vIFNvbWUgc2NoZW1hcyBuZXN0IGNvbXBhcmVBdFByaWNlIG9yIG9yaWdpbmFsUHJpY2VcbiAgICBjb25zdCBnZXRDb21wYXJlID0gKG9iajogYW55KTogc3RyaW5nIHwgdW5kZWZpbmVkID0+IHtcbiAgICAgIGlmICghb2JqKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgcmV0dXJuIG9iai5jb21wYXJlQXRQcmljZSB8fCBvYmoub3JpZ2luYWxQcmljZSB8fCBvYmoucHJpY2VTcGVjaWZpY2F0aW9uPy5wcmljZTtcbiAgICB9O1xuICAgIGlmIChBcnJheS5pc0FycmF5KGxkT2ZmZXJzKSkge1xuICAgICAgZm9yIChjb25zdCBvZmYgb2YgbGRPZmZlcnMpIHtcbiAgICAgICAgY29uc3QgdmFsID0gZ2V0Q29tcGFyZShvZmYpO1xuICAgICAgICBpZiAodmFsKSB7XG4gICAgICAgICAgb3JpZ2luYWwgPSBjbGVhbih2YWwpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbGRPZmZlcnMgPT09ICdvYmplY3QnKSB7XG4gICAgICBjb25zdCB2YWwgPSBnZXRDb21wYXJlKGxkT2ZmZXJzKTtcbiAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgb3JpZ2luYWwgPSBjbGVhbih2YWwpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAoIW9yaWdpbmFsKSB7XG4gICAgLy8gTG9vayBmb3IgZWxlbWVudHMgY29udGFpbmluZyBhIHByaWNlIHdpdGggYSBsaW5l4oCRdGhyb3VnaCBzdHlsZSBvciBhXG4gICAgLy8gY2xhc3MgaW5kaWNhdGluZyBcImNvbXBhcmVcIiBvciBcIm9yaWdpbmFsXCIuIFdlIGV4dHJhY3QgbnVtZXJpY1xuICAgIC8vIHZhbHVlcyAoZGlnaXRzIGFuZCBkZWNpbWFsIHNlcGFyYXRvcnMpLlxuICAgIGNvbnN0IHByaWNlUmVnZXggPSAvKFtcXGQsLl0rKVxccyooPzpbQS1aXXszfSk/LztcbiAgICAvLyBoZWxwZXIgdG8gcGFyc2UgdGV4dFxuICAgIGNvbnN0IHBhcnNlUHJpY2VUZXh0ID0gKHRleHQ6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgbWF0Y2ggPSBwcmljZVJlZ2V4LmV4ZWModGV4dCk7XG4gICAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIC8vIENoZWNrIDxkZWw+IGVsZW1lbnRzXG4gICAgJCgnZGVsLCBzdHJpa2UnKS5lYWNoKChfLCBlbCkgPT4ge1xuICAgICAgY29uc3QgdGV4dCA9ICQoZWwpLnRleHQoKTtcbiAgICAgIGNvbnN0IHZhbCA9IHBhcnNlUHJpY2VUZXh0KHRleHQpO1xuICAgICAgaWYgKHZhbCkge1xuICAgICAgICBvcmlnaW5hbCA9IGNsZWFuKHZhbCk7XG4gICAgICAgIHJldHVybiBmYWxzZTsgLy8gYnJlYWsgdGhlIGxvb3BcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBDaGVjayBlbGVtZW50cyB3aXRoIGNsYXNzIGNvbnRhaW5pbmcgY29tcGFyZSBvciBvcmlnaW5hbFxuICAgIGlmICghb3JpZ2luYWwpIHtcbiAgICAgICQoJ1tjbGFzcyo9XCJjb21wYXJlXCJdLFtjbGFzcyo9XCJvcmlnaW5hbFwiXSxbY2xhc3MqPVwic3RyaWtlXCJdJykuZWFjaCgoXywgZWwpID0+IHtcbiAgICAgICAgY29uc3QgdGV4dCA9ICQoZWwpLnRleHQoKTtcbiAgICAgICAgY29uc3QgdmFsID0gcGFyc2VQcmljZVRleHQodGV4dCk7XG4gICAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgICBvcmlnaW5hbCA9IGNsZWFuKHZhbCk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgLy8gQXNzaWduIG9yaWdpbmFsUHJpY2UgaWYgZm91bmQgYW5kIGRpZmZlcmVudCBmcm9tIHNhbGUgcHJpY2VcbiAgaWYgKG9yaWdpbmFsICYmIG9yaWdpbmFsICE9PSBwcm9kdWN0LnByaWNlKSB7XG4gICAgcHJvZHVjdC5vcmlnaW5hbFByaWNlID0gb3JpZ2luYWw7XG4gIH1cblxuICAvLyBQcmV0aXRsZTogbm90IHdpZGVseSBhdmFpbGFibGUuIEFzIGEgaGV1cmlzdGljLCBpZiB0aGUgdGl0bGVcbiAgLy8gY29udGFpbnMgYSBoeXBoZW4sIHNwbGl0IHRoZSBmaXJzdCBwYXJ0IGFzIHByZXRpdGxlIGFuZCB0aGUgcmVzdFxuICAvLyBhcyB0aGUgYWN0dWFsIHRpdGxlLlxuICBpZiAocHJvZHVjdC50aXRsZSAmJiBwcm9kdWN0LnRpdGxlLmluY2x1ZGVzKCcg4oCTICcpKSB7XG4gICAgY29uc3QgcGFydHMgPSBwcm9kdWN0LnRpdGxlLnNwbGl0KC9cXHMr4oCTXFxzKy8pO1xuICAgIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7XG4gICAgICBwcm9kdWN0LnByZXRpdGxlID0gcGFydHNbMF07XG4gICAgICBwcm9kdWN0LnRpdGxlID0gcGFydHMuc2xpY2UoMSkuam9pbignIOKAkyAnKTtcbiAgICB9XG4gIH1cblxuICAvLyBDb2xvdXIgY2FwdHVyZSByZW1vdmVkIHBlciByZWZhY3Rvcjsgbm8gc3dhdGNoIGRldGVjdGlvblxuXG4gIC8vIEltYWdlczogY29sbGVjdCBhZGRpdGlvbmFsIGltYWdlIFVSTHMgYmV5b25kIHRoZSBwcmltYXJ5IGltYWdlLiBXZVxuICAvLyBzdGFydCB3aXRoIHRoZSBwcmltYXJ5IGltYWdlIGlmIGl0IGV4aXN0cy4gVGhlbiBzZWFyY2ggZm9yIGltYWdlXG4gIC8vIGVsZW1lbnRzIHRoYXQgYXJlIGxpa2VseSBwYXJ0IG9mIHRoZSBwcm9kdWN0IGdhbGxlcnkuIEhldXJpc3RpY3NcbiAgLy8gaW5jbHVkZSBjbGFzcyBuYW1lcyBjb250YWluaW5nIFwicHJvZHVjdFwiLCBcImdhbGxlcnlcIiwgXCJ0aHVtYlwiLCBvclxuICAvLyBcImltYWdlXCIuIFdlIGFsc28gYWNjZXB0IEpTT07igJFMRCBpbWFnZSBhcnJheXMuIE9ubHkgYWJzb2x1dGVcbiAgLy8gVVJMcyAoaHR0cCBvciBodHRwcykgYXJlIGtlcHQgYW5kIGR1cGxpY2F0ZXMgcmVtb3ZlZC5cbiAgY29uc3QgaW1hZ2VTZXQgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgaWYgKHByb2R1Y3QuaW1hZ2UpIHtcbiAgICBpbWFnZVNldC5hZGQocHJvZHVjdC5pbWFnZSk7XG4gIH1cbiAgLy8gQWRkIGFueSBhZGRpdGlvbmFsIGltYWdlcyBmcm9tIEpTT07igJFMRFxuICBpZiAoQXJyYXkuaXNBcnJheShsZC5pbWFnZSkpIHtcbiAgICBmb3IgKGNvbnN0IGltZyBvZiBsZC5pbWFnZSkge1xuICAgICAgaWYgKHR5cGVvZiBpbWcgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGltYWdlU2V0LmFkZChub3JtYWxpc2UoaW1nKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIERPTSBleHRyYWN0aW9uOiBmaW5kIGltYWdlcyB3aXRoIHJlbGV2YW50IGNsYXNzIGhpbnRzXG4gICQoJ2ltZycpLmVhY2goKF8sIGVsKSA9PiB7XG4gICAgY29uc3Qgc3JjID0gbm9ybWFsaXNlKCQoZWwpLmF0dHIoJ3NyYycpKTtcbiAgICBpZiAoIXNyYykgcmV0dXJuO1xuICAgIGlmICghL1xcLihqcGU/Z3xwbmd8Z2lmfHdlYnB8YXZpZnxzdmcpKD86Wz8jXS4qKT8kL2kudGVzdChzcmMpKSByZXR1cm47XG4gICAgLy8gQWNjZXB0IGltYWdlcyBpZiB0aGV5IGNvbnRhaW4gY2VydGFpbiBrZXl3b3JkcyBpbiB0aGVpciBjbGFzcyBvciBpZFxuICAgIGNvbnN0IGNsYXNzZXMgPSAoJChlbCkuYXR0cignY2xhc3MnKSB8fCAnJykgKyAnICcgKyAoJChlbCkucGFyZW50KCkuYXR0cignY2xhc3MnKSB8fCAnJyk7XG4gICAgY29uc3QgaWRzID0gKCQoZWwpLmF0dHIoJ2lkJykgfHwgJycpICsgJyAnICsgKCQoZWwpLnBhcmVudCgpLmF0dHIoJ2lkJykgfHwgJycpO1xuICAgIGNvbnN0IGhheSA9IGNsYXNzZXMgKyAnICcgKyBpZHM7XG4gICAgaWYgKC9wcm9kdWN0fGdhbGxlcnl8dGh1bWJ8aW1hZ2V8c2xpZGVyfGNhcm91c2VsL2kudGVzdChoYXkpKSB7XG4gICAgICBpbWFnZVNldC5hZGQoc3JjKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIEFkZGl0aW9uYWwgZXh0cmFjdGlvbjogYXR0ZW1wdCB0byBmZXRjaCB0aGUgU2hvcGlmeSAuanMgZW5kcG9pbnQgZm9yXG4gIC8vIHJpY2hlciBwcm9kdWN0IGRhdGEuIE1hbnkgU2hvcGlmeSBzdG9yZXMgZXhwb3NlIGEgSlNPTiBmaWxlIGF0XG4gIC8vIDxwcm9kdWN0LXVybD4uanMgd2hpY2ggY29udGFpbnMgYW4gYXJyYXkgb2YgaW1hZ2UgVVJMcyBhbmQgdGhlXG4gIC8vIGZlYXR1cmVkIGltYWdlLiBJZiB0aGUgcmVxdWVzdCBmYWlscyBvciB0aGUgcmVzcG9uc2UgaXMgbm90IEpTT04sXG4gIC8vIHdlIHNpbGVudGx5IGlnbm9yZSBpdC4gV2UgcHJlZml4IHByb3RvY29sLXJlbGF0aXZlIFVSTHMgd2l0aFxuICAvLyBodHRwczogdG8gZW5zdXJlIGFic29sdXRlIHBhdGhzLiBBbnkgaW1hZ2VzIGZvdW5kIGhlcmUgYXJlIGFkZGVkXG4gIC8vIHRvIGltYWdlU2V0LiBUaGlzIGxvZ2ljIG1pcnJvcnMgdGhlIHdvcmtpbmcgaW1wbGVtZW50YXRpb24gZnJvbVxuICAvLyB0aGUgcHJvdmlkZWQgcmVmZXJlbmNlIHBhY2thZ2UuIEl0IGF2b2lkcyBzbGljaW5nIHRoZSBKU09OIGJ5XG4gIC8vIGJyYWNlcyBhbmQgaW5zdGVhZCBsZXRzIEpTT04ucGFyc2UgaGFuZGxlIHRoZSBzdHJpbmcuXG4gIHRyeSB7XG4gICAgY29uc3QganNVcmwgPSB1cmwuZW5kc1dpdGgoJy5qcycpID8gdXJsIDogYCR7dXJsfS5qc2A7XG4gICAgY29uc3QganNSZXNwID0gYXdhaXQgYXhpb3MuZ2V0KGpzVXJsLCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdVc2VyLUFnZW50JzpcbiAgICAgICAgICAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzExNi4wIFNhZmFyaS81MzcuMzYnXG4gICAgICB9LFxuICAgICAgbWF4UmVkaXJlY3RzOiAzXG4gICAgfSk7XG4gICAgY29uc3QganNEYXRhID0ganNSZXNwLmRhdGE7XG4gICAgLy8gSWYgcmVzcG9uc2UgaXMgYSBzdHJpbmcsIGF0dGVtcHQgdG8gcGFyc2UgSlNPTjsgaWYgaXQncyBhbHJlYWR5XG4gICAgLy8gYW4gb2JqZWN0IHdlIGNhbiBwcm9jZXNzIGl0IGRpcmVjdGx5LiBTb21lIHBsYXRmb3JtcyBlc2NhcGVcbiAgICAvLyB1bmljb2RlIHNlcXVlbmNlcywgYnV0IEpTT04ucGFyc2Ugd2lsbCBoYW5kbGUgdGhlbS5cbiAgICBjb25zdCBwYXJzZWREYXRhID1cbiAgICAgIHR5cGVvZiBqc0RhdGEgPT09ICdzdHJpbmcnXG4gICAgICAgID8gSlNPTi5wYXJzZShqc0RhdGEpXG4gICAgICAgIDogdHlwZW9mIGpzRGF0YSA9PT0gJ29iamVjdCdcbiAgICAgICAgPyBqc0RhdGFcbiAgICAgICAgOiBudWxsO1xuICAgIGlmIChwYXJzZWREYXRhICYmIHR5cGVvZiBwYXJzZWREYXRhID09PSAnb2JqZWN0Jykge1xuICAgICAgLy8gRXh0cmFjdCBpbWFnZXMgYXJyYXlcbiAgICAgIGNvbnN0IGltZ3M6IHVua25vd24gPSAocGFyc2VkRGF0YSBhcyBhbnkpLmltYWdlcztcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGltZ3MpKSB7XG4gICAgICAgIGZvciAoY29uc3QgcCBvZiBpbWdzKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBwID09PSAnc3RyaW5nJyAmJiBwKSB7XG4gICAgICAgICAgICBjb25zdCBpbWdVcmwgPSBub3JtYWxpc2UocC5zdGFydHNXaXRoKCcvLycpID8gYGh0dHBzOiR7cH1gIDogcCk7XG4gICAgICAgICAgICBpZiAoaW1nVXJsKSB7XG4gICAgICAgICAgICAgIGltYWdlU2V0LmFkZChpbWdVcmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gRXh0cmFjdCBmZWF0dXJlZCBpbWFnZVxuICAgICAgY29uc3QgZmVhdDogdW5rbm93biA9IChwYXJzZWREYXRhIGFzIGFueSkuZmVhdHVyZWRfaW1hZ2U7XG4gICAgICBpZiAodHlwZW9mIGZlYXQgPT09ICdzdHJpbmcnICYmIGZlYXQpIHtcbiAgICAgICAgY29uc3QgZnVsbCA9IG5vcm1hbGlzZShmZWF0LnN0YXJ0c1dpdGgoJy8vJykgPyBgaHR0cHM6JHtmZWF0fWAgOiBmZWF0KTtcbiAgICAgICAgaWYgKGZ1bGwpIHtcbiAgICAgICAgICBpbWFnZVNldC5hZGQoZnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIFNpbGVudGx5IGlnbm9yZSBlcnJvcnM7IHRoZSBKU09OIGVuZHBvaW50IG1heSBub3QgZXhpc3Qgb3IgbWF5IG5vdFxuICAgIC8vIHJldHVybiB2YWxpZCBKU09OLiBJbiBzdWNoIGNhc2VzIHdlIHNpbXBseSByZWx5IG9uIGltYWdlc1xuICAgIC8vIGV4dHJhY3RlZCBmcm9tIHRoZSBIVE1MIGFuZCBKU09OLUxELlxuICB9XG4gIC8vIEFzc2lnbiBpbWFnZXMgYXJyYXkgaWYgbW9yZSB0aGFuIG9uZSBpbWFnZSBpcyBmb3VuZFxuICBjb25zdCBpbWFnZXNBcnIgPSBBcnJheS5mcm9tKGltYWdlU2V0KTtcbiAgaWYgKGltYWdlc0Fyci5sZW5ndGggPiAwKSB7XG4gICAgLy8gQXNzaWduIHRoZSBpbWFnZXMgZGlyZWN0bHkgZnJvbSBpbWFnZVNldC4gVGhlIGltYWdlU2V0IGl0c2VsZlxuICAgIC8vIGFscmVhZHkgZGVkdXBsaWNhdGVzIGV4YWN0IFVSTHMgd2hpbGUgcHJlc2VydmluZyBpbnNlcnRpb24gb3JkZXIuXG4gICAgLy8gV2Ugbm8gbG9uZ2VyIGRlZHVwbGljYXRlIGJ5IGJhc2UgcGF0aCAocXVlcnkgcGFyYW1ldGVycykgYmVjYXVzZVxuICAgIC8vIHNvbWUgc3RvcmVzIHVzZSB0aGUgc2FtZSBiYXNlIGZvciBkaWZmZXJlbnQgaW1hZ2VzLiBJbnN0ZWFkIHdlXG4gICAgLy8gcHJlc2VydmUgYWxsIHVuaXF1ZSBVUkxzLiBXZSBzdGlsbCBtb3ZlIHRoZSBwcmltYXJ5IGltYWdlIHRvXG4gICAgLy8gdGhlIGZyb250IG9mIHRoZSBhcnJheSBpZiBpdCBleGlzdHMgYW5kIGlzIG5vdCBhbHJlYWR5IGZpcnN0LlxuICAgIGxldCBkZWR1cGVkOiBzdHJpbmdbXSA9IGltYWdlc0FycjtcbiAgICBpZiAocHJvZHVjdC5pbWFnZSkge1xuICAgICAgY29uc3QgaW5kZXggPSBkZWR1cGVkLmZpbmRJbmRleCgoaSkgPT4gaSA9PT0gcHJvZHVjdC5pbWFnZSk7XG4gICAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICAgIGNvbnN0IFtpbWddID0gZGVkdXBlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICBkZWR1cGVkLnVuc2hpZnQoaW1nKTtcbiAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgIGRlZHVwZWQudW5zaGlmdChwcm9kdWN0LmltYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcHJvZHVjdC5pbWFnZXMgPSBkZWR1cGVkO1xuICB9XG5cbiAgcmV0dXJuIHByb2R1Y3Q7XG59XG4iXSwibmFtZXMiOlsiYXhpb3MiLCJjaGVlcmlvIiwicGFyc2VMZEpzb24iLCIkIiwic2NyaXB0cyIsInRvQXJyYXkiLCJlbCIsImNvbnRlbnRzIiwidGV4dCIsImpzb24iLCJKU09OIiwicGFyc2UiLCJ0cmltIiwiY2FuZGlkYXRlcyIsIkFycmF5IiwiaXNBcnJheSIsIm9iaiIsIl8iLCJnZXRNZXRhIiwicHJvcCIsImF0dHIiLCJwYXJzZVByb2R1Y3QiLCJ1cmwiLCJjbGVhbiIsInZhbHVlIiwidG9TdHJpbmciLCJidWlsZE5vcm1hbGlzZXIiLCJwYWdlVXJsIiwib3JpZ2luIiwiYmFzZVBhdGgiLCJ1IiwiVVJMIiwiZW5kc1dpdGgiLCJzdWJzdHJpbmciLCJsYXN0SW5kZXhPZiIsInJhdyIsInZhbCIsInRlc3QiLCJzdGFydHNXaXRoIiwibm9ybWFsaXNlIiwiaHRtbCIsInJlc3BvbnNlIiwiZ2V0IiwiaGVhZGVycyIsIm1heFJlZGlyZWN0cyIsImRhdGEiLCJlcnJvciIsImNvbnNvbGUiLCJFcnJvciIsIm1lc3NhZ2UiLCJwcmV0aXRsZSIsInRpdGxlIiwicHJpY2UiLCJkZXNjcmlwdGlvbiIsImltYWdlIiwiaW1hZ2VzIiwidW5kZWZpbmVkIiwiY3RhIiwiY3RhTGFiZWwiLCJsb2FkIiwicmVNZWdhIiwidG9SZW1vdmUiLCJmaWx0ZXIiLCJsZW5ndGgiLCJyZW1vdmUiLCJsZCIsInByb2R1Y3QiLCJvcmlnaW5hbFByaWNlIiwibWV0YWRhdGFEZXNjcmlwdGlvbiIsIm5hbWUiLCJmaXJzdCIsIm1ldGFUYWdEZXNjcmlwdGlvbiIsImxkRGVzYyIsIm9nRGVzYyIsInR3aXR0ZXJEZXNjIiwib3JpZ2luYWxNZXRhZGF0YURlc2NyaXB0aW9uIiwiZGVzY1Jvb3QiLCJwIiwiZmluZCIsImRlc2NyaXB0aW9uUCIsInVsIiwiZGVzY3JpcHRpb25VbCIsImUiLCJsZEltYWdlIiwibGRPZmZlcnMiLCJvZmZlcnMiLCJsZFByaWNlIiwib3JpZ2luYWwiLCJnZXRDb21wYXJlIiwiY29tcGFyZUF0UHJpY2UiLCJwcmljZVNwZWNpZmljYXRpb24iLCJvZmYiLCJwcmljZVJlZ2V4IiwicGFyc2VQcmljZVRleHQiLCJtYXRjaCIsImV4ZWMiLCJlYWNoIiwiaW5jbHVkZXMiLCJwYXJ0cyIsInNwbGl0Iiwic2xpY2UiLCJqb2luIiwiaW1hZ2VTZXQiLCJTZXQiLCJhZGQiLCJpbWciLCJzcmMiLCJjbGFzc2VzIiwicGFyZW50IiwiaWRzIiwiaGF5IiwianNVcmwiLCJqc1Jlc3AiLCJqc0RhdGEiLCJwYXJzZWREYXRhIiwiaW1ncyIsImltZ1VybCIsImZlYXQiLCJmZWF0dXJlZF9pbWFnZSIsImZ1bGwiLCJlcnIiLCJpbWFnZXNBcnIiLCJmcm9tIiwiZGVkdXBlZCIsImluZGV4IiwiZmluZEluZGV4IiwiaSIsInNwbGljZSIsInVuc2hpZnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/parser.ts\n");

/***/ }),

/***/ "(api)/./pages/api/generate.ts":
/*!*******************************!*\
  !*** ./pages/api/generate.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_parser__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/parser */ \"(api)/./lib/parser.ts\");\n/* harmony import */ var _data_templates__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../data/templates */ \"(api)/./data/templates.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_parser__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_parser__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        res.setHeader(\"Allow\", [\n            \"POST\"\n        ]);\n        res.status(405).end(`Method ${req.method} Not Allowed`);\n        return;\n    }\n    let body;\n    try {\n        body = typeof req.body === \"string\" ? JSON.parse(req.body) : req.body;\n    } catch (error) {\n        res.status(400).json({\n            error: \"Invalid JSON body\"\n        });\n        return;\n    }\n    const urls = Array.isArray(body.urls) ? body.urls : [];\n    if (urls.length === 0) {\n        res.status(400).json({\n            error: \"No URLs provided\"\n        });\n        return;\n    }\n    const template = _data_templates__WEBPACK_IMPORTED_MODULE_1__.defaultTemplates.find((t)=>t.id === body.templateId) || _data_templates__WEBPACK_IMPORTED_MODULE_1__.defaultTemplates[0];\n    const products = [];\n    const htmlFragments = [];\n    for (const url of urls){\n        try {\n            const data = await (0,_lib_parser__WEBPACK_IMPORTED_MODULE_0__.parseProduct)(url);\n            // Skip URLs that return no meaningful product information to avoid\n            // rendering placeholder values like \"Product title\" or \"Price\".\n            // Only consider fields that represent real product information.\n            // Exclude generic fields like url or cta which are always present\n            // even when parsing fails.\n            const meaningfulKeys = [\n                \"pretitle\",\n                \"title\",\n                \"price\",\n                \"description\",\n                \"image\",\n                \"originalPrice\",\n                \"images\"\n            ];\n            const hasInfo = meaningfulKeys.some((key)=>{\n                const value = data[key];\n                return Array.isArray(value) ? value.length > 0 : Boolean(value);\n            });\n            if (!hasInfo) {\n                console.warn(\"Skipping URL with no product data:\", url);\n                continue;\n            }\n            // Include a sanitized source URL (strip query params) so the client can map results back\n            const sourceUrl = url.split(\"?\")[0];\n            products.push({\n                ...data,\n                _sourceUrl: sourceUrl\n            });\n            const fragment = (0,_data_templates__WEBPACK_IMPORTED_MODULE_1__.renderTemplate)(template, data);\n            htmlFragments.push(fragment);\n        } catch (err) {\n            console.error(\"Error generating module for url\", url, err);\n        // If a URL fails outright, skip it and continue with the next one.\n        }\n    }\n    const html = htmlFragments.join(\"\\n\\n\");\n    res.status(200).json({\n        html,\n        products\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvZ2VuZXJhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ2dEO0FBQ3dCO0FBZXpELGVBQWVHLFFBQzVCQyxHQUFtQixFQUNuQkMsR0FBb0I7SUFFcEIsSUFBSUQsSUFBSUUsTUFBTSxLQUFLLFFBQVE7UUFDekJELElBQUlFLFNBQVMsQ0FBQyxTQUFTO1lBQUM7U0FBTztRQUMvQkYsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRUwsSUFBSUUsTUFBTSxDQUFDLFlBQVksQ0FBQztRQUN0RDtJQUNGO0lBRUEsSUFBSUk7SUFDSixJQUFJO1FBQ0ZBLE9BQU8sT0FBT04sSUFBSU0sSUFBSSxLQUFLLFdBQVdDLEtBQUtDLEtBQUssQ0FBQ1IsSUFBSU0sSUFBSSxJQUFJTixJQUFJTSxJQUFJO0lBQ3ZFLEVBQUUsT0FBT0csT0FBTztRQUNkUixJQUFJRyxNQUFNLENBQUMsS0FBS00sSUFBSSxDQUFDO1lBQUVELE9BQU87UUFBb0I7UUFDbEQ7SUFDRjtJQUVBLE1BQU1FLE9BQU9DLE1BQU1DLE9BQU8sQ0FBQ1AsS0FBS0ssSUFBSSxJQUFJTCxLQUFLSyxJQUFJLEdBQUcsRUFBRTtJQUN0RCxJQUFJQSxLQUFLRyxNQUFNLEtBQUssR0FBRztRQUNyQmIsSUFBSUcsTUFBTSxDQUFDLEtBQUtNLElBQUksQ0FBQztZQUFFRCxPQUFPO1FBQW1CO1FBQ2pEO0lBQ0Y7SUFDQSxNQUFNTSxXQUNKbEIsNkRBQWdCQSxDQUFDbUIsSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUVDLEVBQUUsS0FBS1osS0FBS2EsVUFBVSxLQUFLdEIsNkRBQWdCLENBQUMsRUFBRTtJQUUvRSxNQUFNdUIsV0FBVyxFQUFFO0lBQ25CLE1BQU1DLGdCQUFnQixFQUFFO0lBQ3hCLEtBQUssTUFBTUMsT0FBT1gsS0FBTTtRQUN0QixJQUFJO1lBQ0YsTUFBTVksT0FBTyxNQUFNM0IseURBQVlBLENBQUMwQjtZQUNoQyxtRUFBbUU7WUFDbkUsZ0VBQWdFO1lBQ2hFLGdFQUFnRTtZQUNoRSxrRUFBa0U7WUFDbEUsMkJBQTJCO1lBQzNCLE1BQU1FLGlCQUFpQjtnQkFDckI7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7YUFDRDtZQUNELE1BQU1DLFVBQVVELGVBQWVFLElBQUksQ0FBQyxDQUFDQztnQkFDbkMsTUFBTUMsUUFBUSxJQUFhLENBQUNELElBQUk7Z0JBQ2hDLE9BQU9mLE1BQU1DLE9BQU8sQ0FBQ2UsU0FBU0EsTUFBTWQsTUFBTSxHQUFHLElBQUllLFFBQVFEO1lBQzNEO1lBRUEsSUFBSSxDQUFDSCxTQUFTO2dCQUNaSyxRQUFRQyxJQUFJLENBQUMsc0NBQXNDVDtnQkFDbkQ7WUFDRjtZQUNGLHlGQUF5RjtZQUN6RixNQUFNVSxZQUFZVixJQUFJVyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDbkNiLFNBQVNjLElBQUksQ0FBQztnQkFBRSxHQUFHWCxJQUFJO2dCQUFFWSxZQUFZSDtZQUFVO1lBQzdDLE1BQU1JLFdBQVd0QywrREFBY0EsQ0FBQ2lCLFVBQVVRO1lBQzFDRixjQUFjYSxJQUFJLENBQUNFO1FBQ3JCLEVBQUUsT0FBT0MsS0FBSztZQUNaUCxRQUFRckIsS0FBSyxDQUFDLG1DQUFtQ2EsS0FBS2U7UUFDdEQsbUVBQW1FO1FBQ3JFO0lBQ0Y7SUFDQSxNQUFNQyxPQUFPakIsY0FBY2tCLElBQUksQ0FBQztJQUNoQ3RDLElBQUlHLE1BQU0sQ0FBQyxLQUFLTSxJQUFJLENBQUM7UUFBRTRCO1FBQU1sQjtJQUFTO0FBQ3hDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWRtLWJ1aWxkZXIvLi9wYWdlcy9hcGkvZ2VuZXJhdGUudHM/MjY1ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IHBhcnNlUHJvZHVjdCB9IGZyb20gJy4uLy4uL2xpYi9wYXJzZXInO1xuaW1wb3J0IHsgZGVmYXVsdFRlbXBsYXRlcywgcmVuZGVyVGVtcGxhdGUgfSBmcm9tICcuLi8uLi9kYXRhL3RlbXBsYXRlcyc7XG5cbmludGVyZmFjZSBHZW5lcmF0ZVJlcXVlc3RCb2R5IHtcbiAgLyoqXG4gICAqIExpc3Qgb2YgcHJvZHVjdCBwYWdlIFVSTHMgc3VwcGxpZWQgYnkgdGhlIGNsaWVudC4gRWFjaCBVUkxcbiAgICogc2hvdWxkIGJlIGEgZnVsbHkgcXVhbGlmaWVkIGFic29sdXRlIFVSTC5cbiAgICovXG4gIHVybHM6IHN0cmluZ1tdO1xuICAvKipcbiAgICogT3B0aW9uYWwgaWQgb2YgdGhlIHRlbXBsYXRlIHRvIHVzZS4gSWYgbm90IHByb3ZpZGVkIG9yIG5vdFxuICAgKiByZWNvZ25pc2VkIHRoZSBmaXJzdCB0ZW1wbGF0ZSBpbiBkZWZhdWx0VGVtcGxhdGVzIHdpbGwgYmUgdXNlZC5cbiAgICovXG4gIHRlbXBsYXRlSWQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xuICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydQT1NUJ10pO1xuICAgIHJlcy5zdGF0dXMoNDA1KS5lbmQoYE1ldGhvZCAke3JlcS5tZXRob2R9IE5vdCBBbGxvd2VkYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IGJvZHk6IEdlbmVyYXRlUmVxdWVzdEJvZHk7XG4gIHRyeSB7XG4gICAgYm9keSA9IHR5cGVvZiByZXEuYm9keSA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKHJlcS5ib2R5KSA6IHJlcS5ib2R5O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdJbnZhbGlkIEpTT04gYm9keScgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgdXJscyA9IEFycmF5LmlzQXJyYXkoYm9keS51cmxzKSA/IGJvZHkudXJscyA6IFtdO1xuICBpZiAodXJscy5sZW5ndGggPT09IDApIHtcbiAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnTm8gVVJMcyBwcm92aWRlZCcgfSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHRlbXBsYXRlID1cbiAgICBkZWZhdWx0VGVtcGxhdGVzLmZpbmQoKHQpID0+IHQuaWQgPT09IGJvZHkudGVtcGxhdGVJZCkgfHwgZGVmYXVsdFRlbXBsYXRlc1swXTtcblxuICBjb25zdCBwcm9kdWN0cyA9IFtdIGFzIGFueVtdO1xuICBjb25zdCBodG1sRnJhZ21lbnRzID0gW10gYXMgc3RyaW5nW107XG4gIGZvciAoY29uc3QgdXJsIG9mIHVybHMpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHBhcnNlUHJvZHVjdCh1cmwpO1xuICAgICAgLy8gU2tpcCBVUkxzIHRoYXQgcmV0dXJuIG5vIG1lYW5pbmdmdWwgcHJvZHVjdCBpbmZvcm1hdGlvbiB0byBhdm9pZFxuICAgICAgLy8gcmVuZGVyaW5nIHBsYWNlaG9sZGVyIHZhbHVlcyBsaWtlIFwiUHJvZHVjdCB0aXRsZVwiIG9yIFwiUHJpY2VcIi5cbiAgICAgIC8vIE9ubHkgY29uc2lkZXIgZmllbGRzIHRoYXQgcmVwcmVzZW50IHJlYWwgcHJvZHVjdCBpbmZvcm1hdGlvbi5cbiAgICAgIC8vIEV4Y2x1ZGUgZ2VuZXJpYyBmaWVsZHMgbGlrZSB1cmwgb3IgY3RhIHdoaWNoIGFyZSBhbHdheXMgcHJlc2VudFxuICAgICAgLy8gZXZlbiB3aGVuIHBhcnNpbmcgZmFpbHMuXG4gICAgICBjb25zdCBtZWFuaW5nZnVsS2V5cyA9IFtcbiAgICAgICAgJ3ByZXRpdGxlJyxcbiAgICAgICAgJ3RpdGxlJyxcbiAgICAgICAgJ3ByaWNlJyxcbiAgICAgICAgJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgJ2ltYWdlJyxcbiAgICAgICAgJ29yaWdpbmFsUHJpY2UnLFxuICAgICAgICAnaW1hZ2VzJ1xuICAgICAgXTtcbiAgICAgIGNvbnN0IGhhc0luZm8gPSBtZWFuaW5nZnVsS2V5cy5zb21lKChrZXkpID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSAoZGF0YSBhcyBhbnkpW2tleV07XG4gICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlLmxlbmd0aCA+IDAgOiBCb29sZWFuKHZhbHVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWhhc0luZm8pIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdTa2lwcGluZyBVUkwgd2l0aCBubyBwcm9kdWN0IGRhdGE6JywgdXJsKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgLy8gSW5jbHVkZSBhIHNhbml0aXplZCBzb3VyY2UgVVJMIChzdHJpcCBxdWVyeSBwYXJhbXMpIHNvIHRoZSBjbGllbnQgY2FuIG1hcCByZXN1bHRzIGJhY2tcbiAgICBjb25zdCBzb3VyY2VVcmwgPSB1cmwuc3BsaXQoJz8nKVswXTtcbiAgICBwcm9kdWN0cy5wdXNoKHsgLi4uZGF0YSwgX3NvdXJjZVVybDogc291cmNlVXJsIH0pO1xuICAgICAgY29uc3QgZnJhZ21lbnQgPSByZW5kZXJUZW1wbGF0ZSh0ZW1wbGF0ZSwgZGF0YSk7XG4gICAgICBodG1sRnJhZ21lbnRzLnB1c2goZnJhZ21lbnQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2VuZXJhdGluZyBtb2R1bGUgZm9yIHVybCcsIHVybCwgZXJyKTtcbiAgICAgIC8vIElmIGEgVVJMIGZhaWxzIG91dHJpZ2h0LCBza2lwIGl0IGFuZCBjb250aW51ZSB3aXRoIHRoZSBuZXh0IG9uZS5cbiAgICB9XG4gIH1cbiAgY29uc3QgaHRtbCA9IGh0bWxGcmFnbWVudHMuam9pbignXFxuXFxuJyk7XG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgaHRtbCwgcHJvZHVjdHMgfSk7XG59XG4iXSwibmFtZXMiOlsicGFyc2VQcm9kdWN0IiwiZGVmYXVsdFRlbXBsYXRlcyIsInJlbmRlclRlbXBsYXRlIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInNldEhlYWRlciIsInN0YXR1cyIsImVuZCIsImJvZHkiLCJKU09OIiwicGFyc2UiLCJlcnJvciIsImpzb24iLCJ1cmxzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwidGVtcGxhdGUiLCJmaW5kIiwidCIsImlkIiwidGVtcGxhdGVJZCIsInByb2R1Y3RzIiwiaHRtbEZyYWdtZW50cyIsInVybCIsImRhdGEiLCJtZWFuaW5nZnVsS2V5cyIsImhhc0luZm8iLCJzb21lIiwia2V5IiwidmFsdWUiLCJCb29sZWFuIiwiY29uc29sZSIsIndhcm4iLCJzb3VyY2VVcmwiLCJzcGxpdCIsInB1c2giLCJfc291cmNlVXJsIiwiZnJhZ21lbnQiLCJlcnIiLCJodG1sIiwiam9pbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/generate.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fgenerate.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();